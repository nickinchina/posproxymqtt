!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=process.argv.length>2?process.argv[2]:void 0,i=n(11),o=n(8);r=r||"",r&&(r="_"+r),i(null,"mqttpos"+r,o.exchange),n(18)()},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("http")},function(e,t,n){var r=n(3),i=function(e,t,n,i){var o=q.defer(),s={hostname:e,port:443,path:t,method:n,rejectUnauthorized:!1};console.log("options: ",s);var a=r.request(s,function(e){console.log("path: ",s.path),console.log("statusCode: ",e.statusCode),console.log("headers: ",e.headers);var t="";e.on("data",function(e){t+=e}),e.on("end",function(){console.log(t),o.resolve(t)})});return a.on("error",function(e){o.reject(e)}),a.end(i),o.promise};e.exports=function(e){return{post:function(t,n){return i(e,t,"POST",n)},get:function(t){return i(e,t,"GET")}}}},function(e,t,n){var r=n(1),i=function(e,t,n){if(e)t[e]=n;else{var r=0;for(var i in t)r++;t["r"+r]=n}},o=null,s=null,a={fs:n(9),sapphire:n(10)},c=e.exports={exchange:function(e){var t=q.defer(),n=null;if(null==o||null==s||s.platform.toLowerCase()!=e.platform.toLowerCase()||JSON.stringify(s.settings)!=JSON.stringify(e.settings)){o=a[e.platform.toLowerCase()],o.logger=c.logger||console;var u=JSON.parse(JSON.stringify(e.settings));u.platform=e.platform,o.init(u,function(e,t){n=e})}if(n)return t.reject(n),console.log("init errors",n,e),t.promise;s=e;var f=[];r.isArray(e.jobs)?f=e.jobs:f.push(e.jobs);var l={},h=function(e,t){var n=o[e.method||"read"];return n?n(e.url,e.data).then(function(n){i(e.name,l,n),t(null,n)},function(e){t(e)}):void t("The proxy function of "+e.method+" does not exist.")};return vasync.forEachPipeline({func:h,inputs:f},function(e,n){if(e)console.log("exchange error",e),t.reject(e);else{var r=0;for(var i in l)r++;if(1==r)for(var o in l)t.resolve(l[o]);else t.resolve(l)}}),t.promise}}},function(e,t,n){var r=n(2),i=n(24),o="/mnt/posshare",s=function(e,t){var r=n(4).exec,i=r(e,promise.promiseCb3(t));i.on("exit",function(e,n){t.resolve("cmd exit with code:"+e)})},a=function(e,t,n){var i=q.defer();if("win32"===process.platform){o=null;var a="net use "+e+" "+n+" /user:"+t;u.logger.info(a),s(a,i)}else{r.existsSync(o)||r.mkdirSync(o),e=e.replace(/\\/g,"/");var a='mount -t cifs -o username="'+t+'",password="'+n+'" '+e+" "+o;u.logger.info(a),s(a,i)}return i.promise},c=function(e){return"win32"===process.platform?e:(e=e.replace(/\\/g,"/"),o?i.join(o,i.basename(e)):e)},u={init:function(e,t){return"localhost"!=e.ip&&e.user?a(e.ip,e.user,e.password||e.pass):(o=null,promise.emptyPromise("initok"))},write:function(e,t){if(!e)throw"url is required";var n=q.defer();return r.writeFile(c(e),t,promise.promiseCb2(n,"write done")),n.promise},read:function(e){if(!e)throw"url is required";var t=q.defer();if(e instanceof Array){for(var n=[],i=e.length,o=0;o<i;++o){var s=q.defer();r.readFile(c(e[o]),"utf-8",promise.promiseCb2(s,null)),n.push(s.promise)}Promise.all(n).then(function(e){t.resolve(e)})}else r.readFile(c(e),"utf-8",promise.promiseCb2(t,null));return t.promise},list:function(e){var t=q.defer(),n=c(e);return u.logger.info(n),r.readdir(n,promise.promiseCb2(t,null)),t.promise}};e.exports=u},function(e,t,n){var r,i=(n(2),6e4),o=5e3,s=function(e,t){return r.post(e,t)},a=function(e){return r.get(e)},c="/cgi-bin/CGILink?cmd=validate&user=s2k&passwd=A123456",u={token:null,token_ts:null,set_token:function(e){u.token=e,e?u.token_ts=new Date:u.token_ts=null},get_token:function(){if(u.token_ts){var e=new Date,t=Math.floor((e-u.token_ts)/6e4);return t>3?null:u.cookie}return null},change_pass:!1,_dologin:function(e,t){a(e).then(function(e){e.match(/<cookie>(\w+)<\/cookie>/gi),u.set_token(RegExp.$1),u.logger.info("login return:"+u.token),t.resolve(e)},function(e){var n="login error:"+e;u.logger.info(n),t.reject(n)})},_login:function(){var e=c,t=q.defer(),n=u.get_token();return u.logger.info("redis cookie",n),n?t.resolve(n):u._dologin(e,t),t.promise},_release:function(e){var t="/cgi-bin/CGILink?cmd=releaseCredential&cookie=",e=u.get_token();console.log("release run:",e);var n=q.defer();return e?a(t).then(function(e){u.set_token(null),n.resolve("token released")},function(e){u.set_token(null);var t="token release error:"+e;n.resolve(t)}):n.resolve("do not release token "+e),n.promise},_doexchange:function(e,t,n){if(!t)throw"url is required";return u._login().then(function(r){return e(t+"&cookie="+u.token,n)},function(e){return u.logger.info("_doexchange error: ",e),e})},_exchange:function(e,t,n){return u._doexchange(e,t,n).then(function(r){var i=r?r.toLowerCase():"";return i.indexOf("no credential")>-1?u._release(u.token).then(function(r){return u.logger.info("no credential release cookie: ",r),u._doexchange(e,t,n)}):r&&500==r.statusCode?u._doexchange(e,t,n):(u.set_token(u.get_token()),r)},function(e){return u.logger.info("_exchange error: ",e),e})},init:function(e,t){if(!e.ip)return t("ip is required");r=null,u.token=null;var s={rejectUnauthorized:!1,requestTimeout:i,connectTimeout:o};return s.url="https://"+e.ip,r=n(7)(e.ip),e.user=e.user||"s2k",e.pass=e.pass||"A123456",c="/cgi-bin/CGILink?cmd=validate&user="+e.user+"&passwd="+e.pass,t(null,"client created")},write:function(e,t){return u._exchange(s,e,t)},read:function(e,t){return u._exchange(a,e).then(function(e){return e.indexOf("<VFI:Fault>")>-1&&t?u._exchange(a,t):e})},list:function(e){return u._exchange(a,"/cgi-bin/CGILink?cmd=vreportpdlist")}};e.exports=u},function(e,t,n){n(13),n(16),n(15),n(12),n(14),global.promise=n(17);var r=lzstring.decompressFromBase64,i=lzstring.compressToBase64;e.exports=function(e,t,n){var o="ws://104.154.93.147:80",s={},a=function(e,a){a=a||"00:00:00:00:00:00",console.log("mac_address:"+a);var c=t+"_"+a,u="Hello "+c,f=0,l=mqtt.connect(o,{clientId:c,reconnectPeriod:1e4});s.clientid=c,l.subscribe(c),l.subscribe(c+"_lz"),l.on("connect",function(e){console.log("mqtt-connected"),f--}),l.on("reconnect",function(){console.log("mqtt-reconnect")}),l.on("close",function(){console.log("mqtt-close:"+f.toString()),f++,f>10&&"wsproxy.s2konline.net"!=l.options.hostname&&(console.log("use wss instead"),f=0,l.options.hostname="wsproxy.s2konline.net",l.options.host="wsproxy.s2konline.net:443",l.options.port="443",l.options.protocol="wss",l.options.href="wss://wsproxy.s2konline.net:443")}),l.on("error",function(e){console.log("mqtt-error:"+e)});var h="_lz",d=function(e){return e.substr(e.length-3)==h},p=function(e,t){return e?t?r:i:function(e){return e}},g=function(e,t){var r=d(e),i=p(r,!0)(t.toString());if(i==u)return console.log(u);var o=JSON.parse(i);if(o&&o.data){var s={id:o.id,cid:c},a=r?o.cid+h:o.cid,f=n(o.data,o.id);f&&f.then&&f.then(function(e){s.data=e,l.publish(a,p(r)(JSON.stringify(s)))},function(e){s.error=e,l.publish(a,p(r)(JSON.stringify(s)))})}else console.log("can't parse:",i)};l.on("message",g),s.publish=function(e,t){"string"==typeof t||t instanceof String||(t=JSON.stringify(t)),l.publish(e,t)},s.publish_lz=function(e,t){"string"==typeof t||t instanceof String||(t=JSON.stringify(t)),l.publish(e+h,i(t))},l.publish(c,u),s.publish_lz(c,u),s.publish_lz(c,{test:!1})};return e?a(null,e):macaddress.one(a),s}},function(e,t){global.q=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){/*!
		 *
		 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
		 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
		 *
		 * With parts by Tyler Close
		 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
		 * at http://www.opensource.org/licenses/mit-license.html
		 * Forked at ref_send.js version: 2009-05-11
		 *
		 * With parts by Mark Miller
		 * Copyright (C) 2011 Google Inc.
		 *
		 * Licensed under the Apache License, Version 2.0 (the "License");
		 * you may not use this file except in compliance with the License.
		 * You may obtain a copy of the License at
		 *
		 * http://www.apache.org/licenses/LICENSE-2.0
		 *
		 * Unless required by applicable law or agreed to in writing, software
		 * distributed under the License is distributed on an "AS IS" BASIS,
		 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
		 * See the License for the specific language governing permissions and
		 * limitations under the License.
		 *
		 */
!function(t){"use strict";"function"==typeof bootstrap?bootstrap("promise",t):e.exports=t()}(function(){"use strict";function e(e){return function(){return G.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===te(e)||e instanceof H}function r(e,t){if(F&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&e.stack.indexOf(ne)===-1){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var o=n.join("\n"+ne+"\n");e.stack=i(o)}}function i(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var i=t[r];a(i)||o(i)||!i||n.push(i)}return n.join("\n")}function o(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function s(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function a(e){var t=s(e);if(!t)return!1;var n=t[0],r=t[1];return n===W&&r>=z&&r<=ae}function c(){if(F)try{throw new Error}catch(r){var e=r.stack.split("\n"),t=e[0].indexOf("@")>0?e[1]:e[2],n=s(t);if(!n)return;return W=n[0],n[1]}}function u(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function f(e){return e instanceof p?e:y(e)?R(e):M(e)}function l(){function e(e){t=e,o.source=e,J(n,function(t,n){f.nextTick(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],i=Y(l.prototype),o=Y(p.prototype);if(o.promiseDispatch=function(e,i,o){var s=Q(arguments);n?(n.push(s),"when"===i&&o[1]&&r.push(o[1])):f.nextTick(function(){t.promiseDispatch.apply(t,s)})},o.valueOf=function(){if(n)return o;var e=v(t);return m(e)&&(t=e),e},o.inspect=function(){return t?t.inspect():{state:"pending"}},f.longStackSupport&&F)try{throw new Error}catch(e){o.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(n){t||e(f(n))},i.fulfill=function(n){t||e(M(n))},i.reject=function(n){t||e(E(n))},i.notify=function(e){t||J(r,function(t,n){f.nextTick(function(){n(e)})},void 0)},i}function h(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=l();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function d(e){return h(function(t,n){for(var r=0,i=e.length;r<i;r++)f(e[r]).then(t,n)})}function p(e,t,n){void 0===t&&(t=function(e){return E(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=Y(p.prototype);if(r.promiseDispatch=function(n,i,o){var s;try{s=e[i]?e[i].apply(r,o):t.call(r,i,o)}catch(e){s=E(e)}n&&n(s)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function g(e,t,n,r){return f(e).then(t,n,r)}function v(e){if(m(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function m(e){return e instanceof p}function y(e){return t(e)&&"function"==typeof e.then}function b(e){return m(e)&&"pending"===e.inspect().state}function w(e){return!m(e)||"fulfilled"===e.inspect().state}function _(e){return m(e)&&"rejected"===e.inspect().state}function k(){re.length=0,ie.length=0,se||(se=!0)}function x(e,t){se&&("object"==typeof process&&"function"==typeof process.emit&&f.nextTick.runAfter(function(){$(ie,e)!==-1&&(process.emit("unhandledRejection",t,e),oe.push(e))}),ie.push(e),t&&"undefined"!=typeof t.stack?re.push(t.stack):re.push("(no stack) "+t))}function S(e){if(se){var t=$(ie,e);t!==-1&&("object"==typeof process&&"function"==typeof process.emit&&f.nextTick.runAfter(function(){var n=$(oe,e);n!==-1&&(process.emit("rejectionHandled",re[t],e),oe.splice(n,1))}),ie.splice(t,1),re.splice(t,1))}}function E(e){var t=p({when:function(t){return t&&S(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return x(t,e),t}function M(e){return p({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},delete:function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return ee(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function R(e){var t=l();return f.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}}),t.promise}function j(e){return p({isDef:function(){}},function(t,n){return I(e,t,n)},function(){return f(e).inspect()})}function C(e,t,n){return f(e).spread(t,n)}function A(e){return function(){function t(e,t){var s;if("undefined"==typeof StopIteration){try{s=r[e](t)}catch(e){return E(e)}return s.done?f(s.value):g(s.value,i,o)}try{s=r[e](t)}catch(e){return n(e)?f(e.value):E(e)}return g(s,i,o)}var r=e.apply(this,arguments),i=t.bind(t,"next"),o=t.bind(t,"throw");return i()}}function B(e){f.done(f.async(e)())}function L(e){throw new H(e)}function O(e){return function(){return C([this,T(arguments)],function(t,n){return e.apply(t,n)})}}function I(e,t,n){return f(e).dispatch(t,n)}function T(e){return g(e,function(e){var t=0,n=l();return J(e,function(r,i,o){var s;m(i)&&"fulfilled"===(s=i.inspect()).state?e[o]=s.value:(++t,g(i,function(r){e[o]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:o,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function q(e){if(0===e.length)return f.resolve();var t=f.defer(),n=0;return J(e,function(r,i,o){function s(e){t.resolve(e)}function a(){n--,0===n&&t.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function c(e){t.notify({index:o,value:e})}var u=e[o];n++,g(u,s,a,c)},void 0),t.promise}function P(e){return g(e,function(e){return e=Z(e,f),g(T(Z(e,function(e){return g(e,V,V)})),function(){return e})})}function N(e){return f(e).allSettled()}function D(e,t){return f(e).then(void 0,void 0,t)}function U(e,t){return f(e).nodeify(t)}var F=!1;try{throw new Error}catch(e){F=!!e.stack}var W,H,z=c(),V=function(){},K=function(){function e(){for(var e,r;n.next;)n=n.next,e=n.task,n.task=void 0,r=n.domain,r&&(n.domain=void 0,r.enter()),t(e,r);for(;a.length;)e=a.pop(),t(e);i=!1}function t(t,n){try{t()}catch(t){if(s)throw n&&n.exit(),setTimeout(e,0),n&&n.enter(),t;setTimeout(function(){throw t},0)}n&&n.exit()}var n={task:void 0,next:null},r=n,i=!1,o=void 0,s=!1,a=[];if(K=function(e){r=r.next={task:e,domain:s&&process.domain,next:null},i||(i=!0,o())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)s=!0,o=function(){process.nextTick(e)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=function(){o=u,c.port1.onmessage=e,e()};var u=function(){c.port2.postMessage(0)};o=function(){setTimeout(e,0),u()}}else o=function(){setTimeout(e,0)};return K.runAfter=function(e){a.push(e),i||(i=!0,o())},K}(),G=Function.call,Q=e(Array.prototype.slice),J=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),$=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Z=e(Array.prototype.map||function(e,t){var n=this,r=[];return J(n,function(i,o,s){r.push(e.call(t,o,s,n))},void 0),r}),Y=Object.create||function(e){function t(){}return t.prototype=e,new t},X=e(Object.prototype.hasOwnProperty),ee=Object.keys||function(e){var t=[];for(var n in e)X(e,n)&&t.push(n);return t},te=e(Object.prototype.toString);H="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var ne="From previous event:";f.resolve=f,f.nextTick=K,f.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(f.longStackSupport=!0),f.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(Q(arguments,1)):e.resolve(n)}},f.Promise=h,f.promise=h,h.race=d,h.all=T,h.reject=E,h.resolve=f,f.passByCopy=function(e){return e},p.prototype.passByCopy=function(){return this},f.join=function(e,t){return f(e).join(t)},p.prototype.join=function(e){return f([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},f.race=d,p.prototype.race=function(){return this.then(f.race)},f.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(e){return E(e)}}function o(e){if("function"==typeof t){r(e,a);try{return t(e)}catch(e){return E(e)}}return E(e)}function s(e){return"function"==typeof n?n(e):e}var a=this,c=l(),u=!1;return f.nextTick(function(){a.promiseDispatch(function(e){u||(u=!0,c.resolve(i(e)))},"when",[function(e){u||(u=!0,c.resolve(o(e)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=s(e)}catch(e){if(n=!0,!f.onerror)throw e;f.onerror(e)}n||c.notify(t)}]),c.promise},f.tap=function(e,t){return f(e).tap(t)},p.prototype.tap=function(e){return e=f(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},f.when=g,p.prototype.thenResolve=function(e){return this.then(function(){return e})},f.thenResolve=function(e,t){return f(e).thenResolve(t)},p.prototype.thenReject=function(e){return this.then(function(){throw e})},f.thenReject=function(e,t){return f(e).thenReject(t)},f.nearer=v,f.isPromise=m,f.isPromiseAlike=y,f.isPending=b,p.prototype.isPending=function(){return"pending"===this.inspect().state},f.isFulfilled=w,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},f.isRejected=_,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var re=[],ie=[],oe=[],se=!0;f.resetUnhandledRejections=k,f.getUnhandledReasons=function(){return re.slice()},f.stopUnhandledRejectionTracking=function(){k(),se=!1},k(),f.reject=E,f.fulfill=M,f.master=j,f.spread=C,p.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},f.async=A,f.spawn=B,f.return=L,f.promised=O,f.dispatch=I,p.prototype.dispatch=function(e,t){var n=this,r=l();return f.nextTick(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},f.get=function(e,t){return f(e).dispatch("get",[t])},p.prototype.get=function(e){return this.dispatch("get",[e])},f.set=function(e,t,n){return f(e).dispatch("set",[t,n])},p.prototype.set=function(e,t){return this.dispatch("set",[e,t])},f.del=f.delete=function(e,t){return f(e).dispatch("delete",[t])},p.prototype.del=p.prototype.delete=function(e){return this.dispatch("delete",[e])},f.mapply=f.post=function(e,t,n){return f(e).dispatch("post",[t,n])},p.prototype.mapply=p.prototype.post=function(e,t){return this.dispatch("post",[e,t])},f.send=f.mcall=f.invoke=function(e,t){return f(e).dispatch("post",[t,Q(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(e){return this.dispatch("post",[e,Q(arguments,1)])},f.fapply=function(e,t){return f(e).dispatch("apply",[void 0,t])},p.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},f.try=f.fcall=function(e){return f(e).dispatch("apply",[void 0,Q(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,Q(arguments)])},f.fbind=function(e){var t=f(e),n=Q(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(Q(arguments))])}},p.prototype.fbind=function(){var e=this,t=Q(arguments);return function(){return e.dispatch("apply",[this,t.concat(Q(arguments))])}},f.keys=function(e){return f(e).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},f.all=T,p.prototype.all=function(){return T(this)},f.any=q,p.prototype.any=function(){return q(this)},f.allResolved=u(P,"allResolved","allSettled"),p.prototype.allResolved=function(){return P(this)},f.allSettled=N,p.prototype.allSettled=function(){return this.then(function(e){return T(Z(e,function(e){function t(){return e.inspect()}return e=f(e),e.then(t,t)}))})},f.fail=f.catch=function(e,t){return f(e).then(void 0,t)},p.prototype.fail=p.prototype.catch=function(e){return this.then(void 0,e)},f.progress=D,p.prototype.progress=function(e){return this.then(void 0,void 0,e)},f.fin=f.finally=function(e,t){return f(e).finally(t)},p.prototype.fin=p.prototype.finally=function(e){return e=f(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},f.done=function(e,t,n,r){return f(e).done(t,n,r)},p.prototype.done=function(e,t,n){var i=function(e){f.nextTick(function(){if(r(e,o),!f.onerror)throw e;f.onerror(e)})},o=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),o.then(void 0,i)},f.timeout=function(e,t,n){return f(e).timeout(t,n)},p.prototype.timeout=function(e,t){var n=l(),r=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},f.delay=function(e,t){return void 0===t&&(t=e,e=void 0),f(e).delay(t)},p.prototype.delay=function(e){return this.then(function(t){var n=l();return setTimeout(function(){n.resolve(t)},e),n.promise})},f.nfapply=function(e,t){return f(e).nfapply(t)},p.prototype.nfapply=function(e){var t=l(),n=Q(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},f.nfcall=function(e){var t=Q(arguments,1);return f(e).nfapply(t)},p.prototype.nfcall=function(){var e=Q(arguments),t=l();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},f.nfbind=f.denodeify=function(e){var t=Q(arguments,1);return function(){var n=t.concat(Q(arguments)),r=l();return n.push(r.makeNodeResolver()),f(e).fapply(n).fail(r.reject),r.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var e=Q(arguments);return e.unshift(this),f.denodeify.apply(void 0,e)},f.nbind=function(e,t){var n=Q(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(Q(arguments)),o=l();return i.push(o.makeNodeResolver()),f(r).fapply(i).fail(o.reject),o.promise}},p.prototype.nbind=function(){var e=Q(arguments,0);return e.unshift(this),f.nbind.apply(void 0,e)},f.nmapply=f.npost=function(e,t,n){return f(e).npost(t,n)},p.prototype.nmapply=p.prototype.npost=function(e,t){var n=Q(t||[]),r=l();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},f.nsend=f.nmcall=f.ninvoke=function(e,t){var n=Q(arguments,2),r=l();return n.push(r.makeNodeResolver()),f(e).dispatch("post",[t,n]).fail(r.reject),r.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(e){var t=Q(arguments,1),n=l();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},f.nodeify=U,p.prototype.nodeify=function(e){return e?void this.then(function(t){f.nextTick(function(){e(null,t)})},function(t){f.nextTick(function(){e(t)})}):this},f.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ae=c();return f})}])},function(e,t){global.lzstring=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,i=function(){function e(e,t){if(!i[e]){i[e]={};for(var n=0;n<e.length;n++)i[e][e.charAt(n)]=n}return i[e][t]}var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},o={compressToBase64:function(e){if(null==e)return"";var t=o._compress(e,6,function(e){return n.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:o._decompress(t.length,32,function(r){return e(n,t.charAt(r))})},compressToUTF16:function(e){return null==e?"":o._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256}return n},decompressFromUint8Array:function(e){if(null===e||void 0===e)return o.decompress(e);for(var n=new Array(e.length/2),r=0,i=n.length;r<i;r++)n[r]=256*e[2*r]+e[2*r+1];var s=[];return n.forEach(function(e){s.push(t(e))}),o.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return r.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),o._decompress(t.length,32,function(n){return e(r,t.charAt(n))}))},compress:function(e){return o._compress(e,16,function(e){return t(e)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,s={},a={},c="",u="",f="",l=2,h=3,d=2,p=[],g=0,v=0;for(o=0;o<e.length;o+=1)if(c=e.charAt(o),Object.prototype.hasOwnProperty.call(s,c)||(s[c]=h++,a[c]=!0),u=f+c,Object.prototype.hasOwnProperty.call(s,u))f=u;else{if(Object.prototype.hasOwnProperty.call(a,f)){if(f.charCodeAt(0)<256){for(r=0;r<d;r++)g<<=1,v==t-1?(v=0,p.push(n(g)),g=0):v++;for(i=f.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1}else{for(i=1,r=0;r<d;r++)g=g<<1|i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i=0;for(i=f.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1}l--,0==l&&(l=Math.pow(2,d),d++),delete a[f]}else for(i=s[f],r=0;r<d;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1;l--,0==l&&(l=Math.pow(2,d),d++),s[u]=h++,f=String(c)}if(""!==f){if(Object.prototype.hasOwnProperty.call(a,f)){if(f.charCodeAt(0)<256){for(r=0;r<d;r++)g<<=1,v==t-1?(v=0,p.push(n(g)),g=0):v++;for(i=f.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1}else{for(i=1,r=0;r<d;r++)g=g<<1|i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i=0;for(i=f.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1}l--,0==l&&(l=Math.pow(2,d),d++),delete a[f]}else for(i=s[f],r=0;r<d;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1;l--,0==l&&(l=Math.pow(2,d),d++)}for(i=2,r=0;r<d;r++)g=g<<1|1&i,v==t-1?(v=0,p.push(n(g)),g=0):v++,i>>=1;for(;;){if(g<<=1,v==t-1){p.push(n(g));break}v++}return p.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,n,r){var i,o,s,a,c,u,f,l,h=[],d=4,p=4,g=3,v="",m=[],y={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)h[o]=o;for(a=0,u=Math.pow(2,2),f=1;f!=u;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(c>0?1:0)*f,f<<=1;switch(i=a){case 0:for(a=0,u=Math.pow(2,8),f=1;f!=u;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(c>0?1:0)*f,f<<=1;l=t(a);break;case 1:for(a=0,u=Math.pow(2,16),f=1;f!=u;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(c>0?1:0)*f,f<<=1;l=t(a);break;case 2:return""}for(h[3]=l,s=l,m.push(l);;){if(y.index>e)return"";for(a=0,u=Math.pow(2,g),f=1;f!=u;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(c>0?1:0)*f,f<<=1;switch(l=a){case 0:for(a=0,u=Math.pow(2,8),f=1;f!=u;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(c>0?1:0)*f,f<<=1;h[p++]=t(a),l=p-1,d--;break;case 1:for(a=0,u=Math.pow(2,16),f=1;f!=u;)c=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(c>0?1:0)*f,f<<=1;h[p++]=t(a),l=p-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,g),g++),h[l])v=h[l];else{if(l!==p)return null;v=s+s.charAt(0)}m.push(v),h[p++]=s+v.charAt(0),d--,s=v,0==d&&(d=Math.pow(2,g),g++)}}};return o}();r=function(){return i}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))}])},function(e,t,n){global.macaddress=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e,t){function n(e,n,a){n?i[e]=n:r[e]=a,s+=1,s>=o&&t(i.length>0?i:i,r)}var r=[],i=[],o=0,s=0;Object.keys(e).forEach(function(t){o+=1;var r=e[t];(global.setImmediate||global.setTimeout)(function(){r(n.bind(null,t),1)})})}var i=n(1),o={};o.networkInterfaces=function(){var e=i.networkInterfaces(),t={};return Object.keys(e).forEach(function(n){addresses={};var r=!1;e[n].forEach(function(e){e.internal||(addresses[(e.family||"").toLowerCase()]=e.address,r=!0,e.mac&&(addresses.mac=e.mac))}),r&&(t[n]=addresses)}),t};var s;switch(i.platform()){case"win32":s=n(2);break;case"linux":s=n(4);break;case"darwin":case"sunos":s=n(5);break;default:console.warn("node-macaddress: Unkown os.platform(), defaulting to `unix'."),s=n(5)}o.one=function(e,t){if("function"==typeof e){t=e;var n=o.networkInterfaces(),r=["eth0","eth1","en0","en1"];e=Object.keys(n)[0];for(var i=0;i<r.length;i++)if(n[r[i]]){e=r[i];break}if(!n[e])return"function"==typeof t&&t("no interfaces found",null),null;if(n[e].mac)return"function"==typeof t&&t(null,n[e].mac),n[e].mac}return"function"==typeof t&&s(e,t),null},o.all=function(e){var t=o.networkInterfaces(),n={};return Object.keys(t).forEach(function(e){t[e].mac||(n[e]=s.bind(null,e))}),0===Object.keys(n).length?("function"==typeof e&&e(null,t),t):(r(n,function(n,r){Object.keys(r).forEach(function(e){t[e].mac=r[e]}),"function"==typeof e&&e(null,t)}),null)},e.exports=o},function(e,t){e.exports=n(23)},function(e,t,n){function r(e){return e.replace(o,"\\$&")}var i=n(3).exec,o=/[-\/\\^$*+?.()|[\]{}]/g;e.exports=function(e,t){i("ipconfig /all",function(n,i){if(n)return void t(n,null);var o=new RegExp(r(e)).exec(i);return o?(i=i.substring(o.index+e.length),(o=/[A-Fa-f0-9]{2}(\-[A-Fa-f0-9]{2}){5}/.exec(i))?void t(null,o[0].toLowerCase().replace(/\-/g,":")):void t("did not find a mac address",null)):void t("did not find interface in `ipconfig /all`",null)})}},function(e,t){e.exports=n(4)},function(e,t,n){var r=n(3).exec;e.exports=function(e,t){r("cat /sys/class/net/"+e+"/address",function(e,n){return e?void t(e,null):void t(null,n.trim().toLowerCase())})}},function(e,t,n){var r=n(3).exec;e.exports=function(e,t){r("ifconfig "+e,function(e,n){if(e)return void t(e,null);var r=/[a-f0-9]{2}(:[a-f0-9]{2}){5}/.exec(n.toLowerCase());return r?void t(null,r[0].toLowerCase()):void t("did not find a mac address",null)})}}])},function(e,t,n){global.mqtt=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1),i=n(44),o=n(3);e.exports.connect=i,e.exports.MqttClient=r,e.exports.Client=r,e.exports.Store=o},function(e,t,n){"use strict";function r(){return"mqttjs_"+Math.random().toString(16).substr(2,8)}function i(e,t,n){e.emit("packetsend",t);var r=l.writeToStream(t,e.stream);!r&&n?e.stream.once("drain",n):n&&n()}function o(e,t,n){e.outgoingStore.put(t,function(r){return r?n&&n(r):void i(e,t,n)})}function s(){}function a(e,t){var n,i=this;if(!(this instanceof a))return new a(e,t);this.options=t||{};for(n in m)"undefined"==typeof this.options[n]?this.options[n]=m[n]:this.options[n]=t[n];this.options.clientId=this.options.clientId||r(),this.streamBuilder=e,this.outgoingStore=this.options.outgoingStore||new u,this.incomingStore=this.options.incomingStore||new u,this.queueQoSZero=void 0===this.options.queueQoSZero||this.options.queueQoSZero,this._subscribedTopics={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this.nextId=Math.floor(65535*Math.random()),this.outgoing={},this.on("connect",function(){if(!this.disconnected){this.connected=!0;var e=null;e=this.outgoingStore.createStream(),e.once("readable",function(){function t(){var n,r=e.read(1);r&&(!i.disconnecting&&!i.reconnectTimer&&i.options.reconnectPeriod>0?(e.read(0),n=i.outgoing[r.messageId],i.outgoing[r.messageId]=function(e,r){n&&n(e,r),t()},i._sendPacket(r)):e.destroy&&e.destroy())}t()}).on("error",this.emit.bind(this,"error"))}}),this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",this._setupPingTimer),this.on("connect",function(){function e(){var n=t.shift(),r=null;n&&(r=n.packet,i._sendPacket(r,function(t){n.cb&&n.cb(t),e()}))}var t=this.queue;e()}),this.on("connect",function(){this.options.clean&&Object.keys(this._subscribedTopics).length>0&&this.subscribe(this._subscribedTopics)}),this.on("close",function(){null!==i.pingTimer&&(i.pingTimer.clear(),i.pingTimer=null)}),this.on("close",this._setupReconnect),c.EventEmitter.call(this),this._setupStream()}var c=n(2),u=n(3),f=n(22),l=n(25),h=n(4).Writable,d=n(12),p=n(42),g=n(43),v=global.setImmediate||function(e){process.nextTick(e)},m={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0};d(a,c.EventEmitter),a.prototype._setupStream=function(){function e(){var t=c.shift(),r=a;t?n._handlePacket(t,e):(a=null,r())}var t,n=this,r=new h,o=l.parser(this.options),a=null,c=[];this._clearReconnect(),this.stream=this.streamBuilder(this),o.on("packet",function(e){c.push(e)}),r._write=function(t,n,r){a=r,o.parse(t),e()},this.stream.pipe(r),this.stream.on("error",s),f(this.stream,this.emit.bind(this,"close")),t=Object.create(this.options),t.cmd="connect",i(this,t),o.on("error",this.emit.bind(this,"error")),this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){n._cleanUp(!0)},this.options.connectTimeout)},a.prototype._handlePacket=function(e,t){switch(this.emit("packetreceive",e),e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t()}},a.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},a.prototype.publish=function(e,t,n,r){var i;if("function"==typeof n&&(r=n,n=null),n||(n={qos:0,retain:!1}),this._checkDisconnecting(r))return this;switch(i={cmd:"publish",topic:e,payload:t,qos:n.qos,retain:n.retain,messageId:this._nextId()},n.qos){case 1:case 2:this.outgoing[i.messageId]=r||s,this._sendPacket(i);break;default:this._sendPacket(i,r)}return this},a.prototype.subscribe=function(){var e,t,n=Array.prototype.slice.call(arguments),r=[],i=n.shift(),o=n.pop()||s,a=n.pop(),c=this;return"string"==typeof i&&(i=[i]),"function"!=typeof o&&(a=o,o=s),t=g.validateTopics(i),null!==t?(o(new Error("Invalid topic "+t)),this):this._checkDisconnecting(o)?this:(a||(a={qos:0}),Array.isArray(i)?i.forEach(function(e){r.push({topic:e,qos:a.qos})}):Object.keys(i).forEach(function(e){r.push({topic:e,qos:i[e]})}),e={cmd:"subscribe",subscriptions:r,qos:1,retain:!1,dup:!1,messageId:this._nextId()},this.outgoing[e.messageId]=function(e,t){if(!e){r.forEach(function(e){c._subscribedTopics[e.topic]=e.qos});for(var n=t.granted,i=0;i<n.length;i+=1)r[i].qos=n[i]}o(e,r)},this._sendPacket(e),this)},a.prototype.unsubscribe=function(e,t){var n={cmd:"unsubscribe",qos:1,messageId:this._nextId()},r=this;return t=t||s,this._checkDisconnecting(t)?this:("string"==typeof e?n.unsubscriptions=[e]:"object"==typeof e&&e.length&&(n.unsubscriptions=e),n.unsubscriptions.forEach(function(e){delete r._subscribedTopics[e]}),this.outgoing[n.messageId]=t,this._sendPacket(n),this)},a.prototype.end=function(e,t){function n(){i.disconnected=!0,i.incomingStore.close(function(){i.outgoingStore.close(t)})}function r(){i._cleanUp(e,v.bind(null,n))}var i=this;return"function"==typeof e&&(t=e,e=!1),this.disconnecting?this:(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?this.once("outgoingEmpty",setTimeout.bind(null,r,10)):r(),this)},a.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},a.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&e.options.reconnectPeriod>0&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),e.reconnectTimer=setInterval(function(){e._reconnect()},e.options.reconnectPeriod))},a.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},a.prototype._cleanUp=function(e,t){t&&this.stream.on("close",t),e?this.stream.destroy():this._sendPacket({cmd:"disconnect"},v.bind(null,this.stream.end.bind(this.stream))),this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null)},a.prototype._sendPacket=function(e,t){if(!this.connected)return void(e.qos>0||"publish"!==e.cmd||this.queueQoSZero?this.queue.push({packet:e,cb:t}):t&&t(new Error("No connection to broker")));if(this._shiftPingInterval(),"publish"!==e.cmd)return void i(this,e,t);switch(e.qos){case 2:case 1:o(this,e,t);break;case 0:default:i(this,e,t)}},a.prototype._setupPingTimer=function(){var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=p(function(){e._checkPing()},1e3*this.options.keepalive))},a.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},a.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},a.prototype._handlePingresp=function(){this.pingResp=!0},a.prototype._handleConnack=function(e){var t=e.returnCode,n=["","Unacceptable protocol version","Identifier rejected","Server unavailable","Bad username or password","Not authorized"];clearTimeout(this.connackTimer),0===t?(this.reconnecting=!1,this.emit("connect",e)):t>0&&this.emit("error",new Error("Connection refused: "+n[t]))},a.prototype._handlePublish=function(e,t){var n=e.topic.toString(),r=e.payload,i=e.qos,o=e.messageId,s=this;switch(i){case 2:this.incomingStore.put(e,function(){s._sendPacket({cmd:"pubrec",messageId:o},t)});break;case 1:this._sendPacket({cmd:"puback",messageId:o});case 0:this.emit("message",n,r,e),this.handleMessage(e,t)}},a.prototype.handleMessage=function(e,t){t()},a.prototype._handleAck=function(e){var t=e.messageId,n=e.cmd,r=null,i=this.outgoing[t],o=this;if(i){switch(n){case"pubcomp":case"puback":delete this.outgoing[t],this.outgoingStore.del(e,i);break;case"pubrec":r={cmd:"pubrel",qos:2,messageId:t},this._sendPacket(r);break;case"suback":delete this.outgoing[t],i(null,e);break;case"unsuback":delete this.outgoing[t],i(null);break;default:o.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},a.prototype._handlePubrel=function(e,t){var n=e.messageId,r=this;r.incomingStore.get(e,function(i,o){return i?r.emit("error",i):("pubrel"!==o.cmd&&(r.emit("message",o.topic,o.payload,o),r.incomingStore.put(e)),void r._sendPacket({cmd:"pubcomp",messageId:n},t))})},a.prototype._nextId=function(){var e=this.nextId++;return 65535===e&&(this.nextId=1),e},e.exports=a},function(e,t){e.exports=n(5)},function(e,t,n){"use strict";function r(){return this instanceof r?void(this._inflights={}):new r}var i=n(4).Readable,o={objectMode:!0};r.prototype.put=function(e,t){return this._inflights[e.messageId]=e,t&&t(),this},r.prototype.createStream=function(){var e=new i(o),t=this._inflights,n=Object.keys(this._inflights),r=!1,s=0;
return e._read=function(){!r&&s<n.length?this.push(t[n[s++]]):this.push(null)},e.destroy=function(){if(!r){var e=this;r=!0,process.nextTick(function(){e.emit("close")})}},e},r.prototype.del=function(e,t){return e=this._inflights[e.messageId],e?(delete this._inflights[e.messageId],t(null,e)):t&&t(new Error("missing packet")),this},r.prototype.get=function(e,t){return e=this._inflights[e.messageId],e?t(null,e):t&&t(new Error("missing packet")),this},r.prototype.close=function(e){this._inflights=null,e&&e()},e.exports=r},function(e,t,n){var r=function(){try{return n(5)}catch(e){}}();t=e.exports=n(6),t.Stream=r||t,t.Readable=t,t.Writable=n(17),t.Duplex=n(16),t.Transform=n(20),t.PassThrough=n(21),!process.browser&&"disable"===process.env.READABLE_STREAM&&r&&(e.exports=r)},function(e,t){e.exports=n(25)},function(e,t,n){"use strict";function r(e,t,n){return"function"==typeof e.prependListener?e.prependListener(t,n):void(e._events&&e._events[t]?B(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n))}function i(e,t){C=C||n(16),e=e||{},this.objectMode=!!e.objectMode,t instanceof C&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new U,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(D||(D=n(19).StringDecoder),this.decoder=new D(e.encoding),this.encoding=e.encoding)}function o(e){return C=C||n(16),this instanceof o?(this._readableState=new i(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),void L.call(this)):new o(e)}function s(e,t,n,r,i){var o=f(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,l(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var c=new Error("stream.unshift() after end event");e.emit("error",c)}else{var u;!t.decoder||i||r||(n=t.decoder.write(n),u=!t.objectMode&&0===n.length),i||(t.reading=!1),u||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&h(e))),p(e,t)}else i||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function c(e){return e>=F?e=F:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function u(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=c(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function f(e,t){var n=null;return I.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function l(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,h(e)}}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(N("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?A(d,e):d(e))}function d(e){N("emit readable"),e.emit("readable"),w(e)}function p(e,t){t.readingMore||(t.readingMore=!0,A(g,e,t))}function g(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(N("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function v(e){return function(){var t=e._readableState;N("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&O(e,"data")&&(t.flowing=!0,w(e))}}function m(e){N("readable nexttick read 0"),e.read(0)}function y(e,t){t.resumeScheduled||(t.resumeScheduled=!0,A(b,e,t))}function b(e,t){t.reading||(N("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),w(e),t.flowing&&!t.reading&&e.read(0)}function w(e){var t=e._readableState;for(N("flow",t.flowing);t.flowing&&null!==e.read(););}function _(e,t){if(0===t.length)return null;var n;return t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=k(e,t.buffer,t.decoder),n}function k(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?x(e,t):S(e,t),r}function x(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(i+=s===o.length?o:o.slice(0,e),e-=s,0===e){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}function S(e,t){var n=T.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),e-=s,0===e){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}function E(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,A(M,t,e))}function M(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function R(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function j(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=o;var C,A=n(7),B=n(8);o.ReadableState=i;var L,O=(n(2).EventEmitter,function(e,t){return e.listeners(t).length});!function(){try{L=n(5)}catch(e){}finally{L||(L=n(2).EventEmitter)}}();var I=n(9).Buffer,T=n(10),q=n(11);q.inherits=n(12);var P=n(13),N=void 0;N=P&&P.debuglog?P.debuglog("stream"):function(){};var D,U=n(15);q.inherits(o,L),o.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=T.from(e,t),t="")),s(this,n,e,t,!1)},o.prototype.unshift=function(e){var t=this._readableState;return s(this,t,e,"",!0)},o.prototype.isPaused=function(){return this._readableState.flowing===!1},o.prototype.setEncoding=function(e){return D||(D=n(19).StringDecoder),this._readableState.decoder=new D(e),this._readableState.encoding=e,this};var F=8388608;o.prototype.read=function(e){N("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return N("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?E(this):h(this),null;if(e=u(e,t),0===e&&t.ended)return 0===t.length&&E(this),null;var r=t.needReadable;N("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,N("length less than watermark",r)),t.ended||t.reading?(r=!1,N("reading or ended",r)):r&&(N("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=u(n,t)));var i;return i=e>0?_(e,t):null,null===i?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&E(this)),null!==i&&this.emit("data",i),i},o.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},o.prototype.pipe=function(e,t){function n(e){N("onunpipe"),e===l&&o()}function i(){N("onend"),e.end()}function o(){N("cleanup"),e.removeListener("close",c),e.removeListener("finish",u),e.removeListener("drain",g),e.removeListener("error",a),e.removeListener("unpipe",n),l.removeListener("end",i),l.removeListener("end",o),l.removeListener("data",s),m=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function s(t){N("ondata"),y=!1;var n=e.write(t);!1!==n||y||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&j(h.pipes,e)!==-1)&&!m&&(N("false write response, pause",l._readableState.awaitDrain),l._readableState.awaitDrain++,y=!0),l.pause())}function a(t){N("onerror",t),f(),e.removeListener("error",a),0===O(e,"error")&&e.emit("error",t)}function c(){e.removeListener("finish",u),f()}function u(){N("onfinish"),e.removeListener("close",c),f()}function f(){N("unpipe"),l.unpipe(e)}var l=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,N("pipe count=%d opts=%j",h.pipesCount,t);var d=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,p=d?i:o;h.endEmitted?A(p):l.once("end",p),e.on("unpipe",n);var g=v(l);e.on("drain",g);var m=!1,y=!1;return l.on("data",s),r(e,"error",a),e.once("close",c),e.once("finish",u),e.emit("pipe",l),h.flowing||(N("pipe resume"),l.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=j(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var n=L.prototype.on.call(this,e,t);if("data"===e)this._readableState.flowing!==!1&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&h(this,r):A(m,this))}return n},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(N("resume"),e.flowing=!0,y(this,e)),this},o.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(N("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(N("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var o=r.push(i);o||(n=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return R(o,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){N("wrapped _read",t),n&&(n=!1,e.resume())},r},o._fromList=_},function(e,t){"use strict";function n(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,n)});case 4:return process.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick(function(){e.apply(null,i)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports=n:e.exports=process.nextTick},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=n(20)},function(e,t,n){"use strict";var r=n(9),i=r.Buffer,o=r.SlowBuffer,s=r.kMaxLength||2147483647;t.alloc=function(e,t,n){if("function"==typeof i.alloc)return i.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");var r=n,o=t;void 0===o&&(r=void 0,o=0);var a=new i(e);if("string"==typeof o)for(var c=new i(o,r),u=c.length,f=-1;++f<e;)a[f]=c[f%u];else a.fill(o);return a},t.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");return new i(e)},t.from=function(e,t,n){if("function"==typeof i.from&&(!global.Uint8Array||Uint8Array.from!==i.from))return i.from(e,t,n);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new i(e,t);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var r=t;if(1===arguments.length)return new i(e);"undefined"==typeof r&&(r=0);var o=n;if("undefined"==typeof o&&(o=e.byteLength-r),r>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(o>e.byteLength-r)throw new RangeError("'length' is out of bounds");return new i(e.slice(r,r+o))}if(i.isBuffer(e)){var s=new i(e.length);return e.copy(s,0,0,e.length),s}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new i(e);if("Buffer"===e.type&&Array.isArray(e.data))return new i(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},t.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=s)throw new RangeError("size is too large");return new o(e)}},function(e,t){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===v(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function s(e){return"number"==typeof e}function a(e){return"string"==typeof e}function c(e){return"symbol"==typeof e}function u(e){return void 0===e}function f(e){return"[object RegExp]"===v(e)}function l(e){return"object"==typeof e&&null!==e}function h(e){return"[object Date]"===v(e)}function d(e){return"[object Error]"===v(e)||e instanceof Error}function p(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function v(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=o,t.isNumber=s,t.isString=a,t.isSymbol=c,t.isUndefined=u,t.isRegExp=f,t.isObject=l,t.isDate=h,t.isError=d,t.isFunction=p,t.isPrimitive=g,t.isBuffer=Buffer.isBuffer},function(e,t,n){try{var r=n(13);if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=n(14)}},function(e,t){e.exports=n(1)},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";function r(){this.head=null,this.tail=null,this.length=0}var i=(n(9).Buffer,n(10));e.exports=r,r.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},r.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},r.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},r.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t}},function(e,t,n){"use strict";function r(e){return this instanceof r?(u.call(this,e),f.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(e)}function i(){this.allowHalfOpen||this._writableState.ended||a(o,this)}function o(e){e.end()}var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var a=n(7),c=n(11);c.inherits=n(12);var u=n(6),f=n(17);c.inherits(r,u);for(var l=s(f.prototype),h=0;h<l.length;h++){var d=l[h];r.prototype[d]||(r.prototype[d]=f.prototype[d])}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(e,t){x=x||n(16),e=e||{},this.objectMode=!!e.objectMode,t instanceof x&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){p(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new k(this)}function s(e){return x=x||n(16),B.call(s,this)||this instanceof x?(this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void R.call(this)):new s(e)}function a(e,t){var n=new Error("write after end");e.emit("error",n),S(t,n)}function c(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):C.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),S(r,o),i=!1),i}function u(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=A.from(t,n)),t}function f(e,t,n,r,o){n=u(t,n,r),C.isBuffer(n)&&(r="buffer");var s=t.objectMode?1:n.length;t.length+=s;var a=t.length<t.highWaterMark;if(a||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest=new i(n,r,o),c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else l(e,t,!1,s,n,r,o);return a}function l(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function h(e,t,n,r,i){--t.pendingcb,n?S(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function p(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(d(n),t)h(e,n,r,t,i);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||m(e,n),r?E(g,e,n,o,i):g(e,n,o,i)}}function g(e,t,n,r){n||v(e,t),t.pendingcb--,r(),w(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;l(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new k(t)}else{for(;n;){var a=n.chunk,c=n.encoding,u=n.callback,f=t.objectMode?1:a.length;if(l(e,t,!1,f,a,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function w(e,t){var n=y(t);return n&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),n}function _(e,t,n){t.ending=!0,w(e,t),n&&(t.finished?S(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function k(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}e.exports=s;var x,S=n(7),E=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:S;s.WritableState=o;var M=n(11);M.inherits=n(12);var R,j={deprecate:n(18)};!function(){try{R=n(5)}catch(e){}finally{R||(R=n(2).EventEmitter)}}();var C=n(9).Buffer,A=n(10);M.inherits(s,R),o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:j.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var B;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(B=Function.prototype[Symbol.hasInstance],Object.defineProperty(s,Symbol.hasInstance,{value:function(e){return!!B.call(this,e)||e&&e._writableState instanceof o}})):B=function(e){return e instanceof this},s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(e,t,n){var i=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),C.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=r),i.ended?a(this,n):c(this,i,e,n)&&(i.pendingcb++,o=f(this,i,e,t,n)),o},s.prototype.cork=function(){var e=this._writableState;e.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||m(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},s.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||_(this,r,n)}},function(e,t,n){e.exports=n(13).deprecate},function(e,t,n){function r(e){if(e&&!c(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function s(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=n(9).Buffer,c=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=i)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return i(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);a.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,n){s(t,e,n)}):s(t)})}function s(e,t,n){if(t)return e.emit("error",t);null!==n&&void 0!==n&&e.push(n);var r=e._writableState,i=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=o;var a=n(16),c=n(11);c.inherits=n(12),c.inherits(o,a),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,n){"use strict";function r(e){return this instanceof r?void i.call(this,e):new r(e)}e.exports=r;var i=n(20),o=n(11);o.inherits=n(12),o.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){var r=n(23),i=function(){},o=function(e){return e.setHeader&&"function"==typeof e.abort},s=function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length},a=function(e,t,n){if("function"==typeof t)return a(e,null,t);t||(t={}),n=r(n||i);var c=e._writableState,u=e._readableState,f=t.readable||t.readable!==!1&&e.readable,l=t.writable||t.writable!==!1&&e.writable,h=function(){e.writable||d()},d=function(){l=!1,f||n()},p=function(){f=!1,l||n()},g=function(e){n(e?new Error("exited with error code: "+e):null)},v=function(){return(!f||u&&u.ended)&&(!l||c&&c.ended)?void 0:n(new Error("premature close"))},m=function(){e.req.on("finish",d)};return o(e)?(e.on("complete",d),e.on("abort",v),e.req?m():e.on("request",m)):l&&!c&&(e.on("end",h),e.on("close",h)),s(e)&&e.on("exit",g),e.on("end",p),e.on("finish",d),t.error!==!1&&e.on("error",n),e.on("close",v),function(){e.removeListener("complete",d),e.removeListener("abort",v),e.removeListener("request",m),e.req&&e.req.removeListener("finish",d),e.removeListener("end",h),e.removeListener("close",h),e.removeListener("finish",d),e.removeListener("exit",g),e.removeListener("end",p),e.removeListener("error",n),e.removeListener("close",v)}};e.exports=a},function(e,t,n){function r(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}var i=n(24);e.exports=i(r),r.proto=r(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0})})},function(e,t){function n(e,t){function r(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];var r=e.apply(this,t),i=t[t.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach(function(e){r[e]=i[e]}),r}if(e&&t)return n(e)(t);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(t){r[t]=e[t]}),r}e.exports=n},function(e,t,n){"use strict";t.parser=n(26),t.generate=n(39),t.writeToStream=n(40)},function(e,t,n){"use strict";function r(){return this instanceof r?(this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],void this._resetState()):new r}var i=n(27),o=n(12),s=n(2).EventEmitter,a=n(37),c=n(38);o(r,s),r.prototype._resetState=function(){this.packet=new a,this.error=null,this._list=i(),this._stateCounter=0},r.prototype.parse=function(e){for(this.error&&this._resetState(),this._list.append(e);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},r.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=c.types[e>>c.CMD_SHIFT],this.packet.retain=0!==(e&c.RETAIN_MASK),this.packet.qos=e>>c.QOS_SHIFT&c.QOS_MASK,this.packet.dup=0!==(e&c.DUP_MASK),this._list.consume(1),!0},r.prototype._parseLength=function(){for(var e,t=0,n=1,r=0,i=!0;t<5&&(e=this._list.readUInt8(t++),r+=n*(e&c.LENGTH_MASK),n*=128,0!==(e&c.LENGTH_FIN_MASK));)if(this._list.length<=t){i=!1;break}return i&&(this.packet.length=r,this._list.consume(t)),i},r.prototype._parsePayload=function(){var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseMessageId();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":case"disconnect":break;default:this._emitError(new Error("Not supported"))}e=!0}return e},r.prototype._parseConnect=function(){var e,t,n,r,i,o,s={},a=this.packet;if(e=this._parseString(),null===e)return this._emitError(new Error("Cannot parse protocol id"));if("MQTT"!==e&&"MQIsdp"!==e)return this._emitError(new Error("Invalid protocol id"));if(a.protocolId=e,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.protocolVersion=this._list.readUInt8(this._pos),3!==a.protocolVersion&&4!==a.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.username=this._list.readUInt8(this._pos)&c.USERNAME_MASK,s.password=this._list.readUInt8(this._pos)&c.PASSWORD_MASK,s.will=this._list.readUInt8(this._pos)&c.WILL_FLAG_MASK,s.will&&(a.will={},a.will.retain=0!==(this._list.readUInt8(this._pos)&c.WILL_RETAIN_MASK),a.will.qos=(this._list.readUInt8(this._pos)&c.WILL_QOS_MASK)>>c.WILL_QOS_SHIFT),a.clean=0!==(this._list.readUInt8(this._pos)&c.CLEAN_SESSION_MASK),this._pos++,a.keepalive=this._parseNum(),a.keepalive===-1)return this._emitError(new Error("Packet too short"));if(t=this._parseString(),null===t)return this._emitError(new Error("Packet too short"));if(a.clientId=t,s.will){if(n=this._parseString(),null===n)return this._emitError(new Error("Cannot parse will topic"));if(a.will.topic=n,r=this._parseBuffer(),null===r)return this._emitError(new Error("Cannot parse will payload"));a.will.payload=r;
}if(s.username){if(o=this._parseString(),null===o)return this._emitError(new Error("Cannot parse username"));a.username=o}if(s.password){if(i=this._parseBuffer(),null===i)return this._emitError(new Error("Cannot parse password"));a.password=i}return a},r.prototype._parseConnack=function(){var e=this.packet;return this._list.length<2?null:(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&c.SESSIONPRESENT_MASK),e.returnCode=this._list.readUInt8(this._pos),e.returnCode===-1?this._emitError(new Error("Cannot parse return code")):void 0)},r.prototype._parsePublish=function(){var e=this.packet;return e.topic=this._parseString(),null===e.topic?this._emitError(new Error("Cannot parse topic")):void(e.qos>0&&!this._parseMessageId()||(e.payload=this._list.slice(this._pos,e.length)))},r.prototype._parseSubscribe=function(){var e,t,n=this.packet;if(1!==n.qos)return this._emitError(new Error("Wrong subscribe header"));if(n.subscriptions=[],this._parseMessageId())for(;this._pos<n.length;){if(e=this._parseString(),null===e)return this._emitError(new Error("Cannot parse topic"));t=this._list.readUInt8(this._pos++),n.subscriptions.push({topic:e,qos:t})}},r.prototype._parseSuback=function(){if(this.packet.granted=[],this._parseMessageId())for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))},r.prototype._parseUnsubscribe=function(){var e=this.packet;if(e.unsubscriptions=[],this._parseMessageId())for(;this._pos<e.length;){var t;if(t=this._parseString(),null===t)return this._emitError(new Error("Cannot parse topic"));e.unsubscriptions.push(t)}},r.prototype._parseUnsuback=function(){if(!this._parseMessageId())return this._emitError(new Error("Cannot parse message id"))},r.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null!==e.messageId||(this._emitError(new Error("Cannot parse message id")),!1)},r.prototype._parseString=function(e){var t,n=this._parseNum(),r=n+this._pos;return n===-1||r>this._list.length||r>this.packet.length?null:(t=this._list.toString("utf8",this._pos,r),this._pos+=n,t)},r.prototype._parseBuffer=function(){var e,t=this._parseNum(),n=t+this._pos;return t===-1||n>this._list.length||n>this.packet.length?null:(e=this._list.slice(this._pos,n),this._pos+=t,e)},r.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var e=this._list.readUInt16BE(this._pos);return this._pos+=2,e},r.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new a,!0},r.prototype._emitError=function(e){this.error=e,this.emit("error",e)},e.exports=r},function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)})}else this.append(e);i.call(this)}var i=n(28),o=n(13);o.inherits(r,i),r.prototype._offset=function(e){for(var t,n=0,r=0;r<this._bufs.length;r++){if(t=n+this._bufs[r].length,e<t)return[r,e-n];n=t}},r.prototype.append=function(e){var t,n=0;if(Array.isArray(e))for(;n<e.length;n++)this.append(e[n]);else if(e instanceof r)for(;n<e._bufs.length;n++)this.append(e._bufs[n]);else null!=e&&("number"==typeof e&&(e=e.toString()),t=Buffer.isBuffer(e)?e:new Buffer(e),this._bufs.push(t),this.length+=t.length);return this},r.prototype._write=function(e,t,n){this.append(e),"function"==typeof n&&n()},r.prototype._read=function(e){return this.length?(e=Math.min(e,this.length),this.push(this.slice(0,e)),void this.consume(e)):this.push(null)},r.prototype.end=function(e){i.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},r.prototype.get=function(e){return this.slice(e,e+1)[0]},r.prototype.slice=function(e,t){return this.copy(null,0,e,t)},r.prototype.copy=function e(t,n,r,i){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof i||i>this.length)&&(i=this.length),r>=this.length)return t||new Buffer(0);if(i<=0)return t||new Buffer(0);var o,s,e=!!t,a=this._offset(r),c=i-r,u=c,f=e&&n||0,l=a[1];if(0===r&&i==this.length){if(!e)return Buffer.concat(this._bufs);for(s=0;s<this._bufs.length;s++)this._bufs[s].copy(t,f),f+=this._bufs[s].length;return t}if(u<=this._bufs[a[0]].length-l)return e?this._bufs[a[0]].copy(t,n,l,l+u):this._bufs[a[0]].slice(l,l+u);for(e||(t=new Buffer(c)),s=a[0];s<this._bufs.length;s++){if(o=this._bufs[s].length-l,!(u>o)){this._bufs[s].copy(t,f,l,l+u);break}this._bufs[s].copy(t,f,l),f+=o,u-=o,l&&(l=0)}return t},r.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)},r.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},r.prototype.duplicate=function(){for(var e=0,t=new r;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},r.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var t in e)!function(t){r.prototype[t]=function(n){return this.slice(n,n+e[t])[t](0)}}(t)}(),e.exports=r},function(e,t,n){e.exports=n(29)},function(e,t,n){"use strict";function r(e){return this instanceof r?(u.call(this,e),f.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(e)}function i(){this.allowHalfOpen||this._writableState.ended||a(o,this)}function o(e){e.end()}var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var a=n(30),c=n(31);c.inherits=n(12);var u=n(32),f=n(35);c.inherits(r,u);for(var l=s(f.prototype),h=0;h<l.length;h++){var d=l[h];r.prototype[d]||(r.prototype[d]=f.prototype[d])}},function(e,t){"use strict";function n(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,n)});case 4:return process.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick(function(){e.apply(null,i)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports=n:e.exports=process.nextTick},function(e,t){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===v(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function s(e){return"number"==typeof e}function a(e){return"string"==typeof e}function c(e){return"symbol"==typeof e}function u(e){return void 0===e}function f(e){return"[object RegExp]"===v(e)}function l(e){return"object"==typeof e&&null!==e}function h(e){return"[object Date]"===v(e)}function d(e){return"[object Error]"===v(e)||e instanceof Error}function p(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function v(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=o,t.isNumber=s,t.isString=a,t.isSymbol=c,t.isUndefined=u,t.isRegExp=f,t.isObject=l,t.isDate=h,t.isError=d,t.isFunction=p,t.isPrimitive=g,t.isBuffer=Buffer.isBuffer},function(e,t,n){"use strict";function r(e,t){I=I||n(29),e=e||{},this.objectMode=!!e.objectMode,t instanceof I&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(O||(O=n(34).StringDecoder),this.decoder=new O(e.encoding),this.encoding=e.encoding)}function i(e){return I=I||n(29),this instanceof i?(this._readableState=new r(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),void j.call(this)):new i(e)}function o(e,t,n,r,i){var o=u(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,f(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else{var c;!t.decoder||i||r||(n=t.decoder.write(n),c=!t.objectMode&&0===n.length),i||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&l(e))),d(e,t)}else i||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function a(e){return e>=T?e=T:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function c(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=a(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function u(e,t){var n=null;return R.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function f(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,l(e)}}function l(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(L("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?E(h,e):h(e))}function h(e){L("emit readable"),e.emit("readable"),b(e)}function d(e,t){t.readingMore||(t.readingMore=!0,E(p,e,t))}function p(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(L("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function g(e){return function(){var t=e._readableState;L("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&C(e,"data")&&(t.flowing=!0,b(e))}}function v(e){L("readable nexttick read 0"),e.read(0)}function m(e,t){t.resumeScheduled||(t.resumeScheduled=!0,E(y,e,t))}function y(e,t){t.reading||(L("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),b(e),t.flowing&&!t.reading&&e.read(0)}function b(e){var t=e._readableState;if(L("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function w(e,t){var n,r=t.buffer,i=t.length,o=!!t.decoder,s=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(s)n=r.shift();else if(!e||e>=i)n=o?r.join(""):1===r.length?r[0]:R.concat(r,i),r.length=0;else if(e<r[0].length){var a=r[0];n=a.slice(0,e),r[0]=a.slice(e)}else if(e===r[0].length)n=r.shift();else{n=o?"":new R(e);for(var c=0,u=0,f=r.length;u<f&&c<e;u++){var a=r[0],l=Math.min(e-c,a.length);o?n+=a.slice(0,l):a.copy(n,c,0,l),l<a.length?r[0]=a.slice(l):r.shift(),c+=l}}return n}function _(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,E(k,t,e))}function k(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function S(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=i;var E=n(30),M=n(33),R=n(9).Buffer;i.ReadableState=r;var j,C=(n(2),function(e,t){return e.listeners(t).length});!function(){try{j=n(5)}catch(e){}finally{j||(j=n(2).EventEmitter)}}();var R=n(9).Buffer,A=n(31);A.inherits=n(12);var B=n(13),L=void 0;L=B&&B.debuglog?B.debuglog("stream"):function(){};var O;A.inherits(i,j);var I,I;i.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=new R(e,t),t="")),o(this,n,e,t,!1)},i.prototype.unshift=function(e){var t=this._readableState;return o(this,t,e,"",!0)},i.prototype.isPaused=function(){return this._readableState.flowing===!1},i.prototype.setEncoding=function(e){return O||(O=n(34).StringDecoder),this._readableState.decoder=new O(e),this._readableState.encoding=e,this};var T=8388608;i.prototype.read=function(e){L("read",e);var t=this._readableState,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return L("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?_(this):l(this),null;if(e=c(e,t),0===e&&t.ended)return 0===t.length&&_(this),null;var r=t.needReadable;L("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,L("length less than watermark",r)),(t.ended||t.reading)&&(r=!1,L("reading or ended",r)),r&&(L("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=c(n,t));var i;return i=e>0?w(e,t):null,null===i&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&_(this),null!==i&&this.emit("data",i),i},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){L("onunpipe"),e===f&&i()}function r(){L("onend"),e.end()}function i(){L("cleanup"),e.removeListener("close",a),e.removeListener("finish",c),e.removeListener("drain",p),e.removeListener("error",s),e.removeListener("unpipe",n),f.removeListener("end",r),f.removeListener("end",i),f.removeListener("data",o),v=!0,!l.awaitDrain||e._writableState&&!e._writableState.needDrain||p()}function o(t){L("ondata");var n=e.write(t);!1===n&&(1!==l.pipesCount||l.pipes[0]!==e||1!==f.listenerCount("data")||v||(L("false write response, pause",f._readableState.awaitDrain),f._readableState.awaitDrain++),f.pause())}function s(t){L("onerror",t),u(),e.removeListener("error",s),0===C(e,"error")&&e.emit("error",t)}function a(){e.removeListener("finish",c),u()}function c(){L("onfinish"),e.removeListener("close",a),u()}function u(){L("unpipe"),f.unpipe(e)}var f=this,l=this._readableState;switch(l.pipesCount){case 0:l.pipes=e;break;case 1:l.pipes=[l.pipes,e];break;default:l.pipes.push(e)}l.pipesCount+=1,L("pipe count=%d opts=%j",l.pipesCount,t);var h=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,d=h?r:i;l.endEmitted?E(d):f.once("end",d),e.on("unpipe",n);var p=g(f);e.on("drain",p);var v=!1;return f.on("data",o),e._events&&e._events.error?M(e._events.error)?e._events.error.unshift(s):e._events.error=[s,e._events.error]:e.on("error",s),e.once("close",a),e.once("finish",c),e.emit("pipe",f),l.flowing||(L("pipe resume"),f.resume()),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=S(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var n=j.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&!this._readableState.endEmitted){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&l(this,r):E(v,this))}return n},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var e=this._readableState;return e.flowing||(L("resume"),e.flowing=!0,m(this,e)),this},i.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(L("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(L("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var o=r.push(i);o||(n=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return x(o,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){L("wrapped _read",t),n&&(n=!1,e.resume())},r},i._fromList=w},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){function r(e){if(e&&!c(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function s(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=n(9).Buffer,c=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=i)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(e,t){C=C||n(29),e=e||{},this.objectMode=!!e.objectMode,t instanceof C&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){p(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new k(this),this.corkedRequestsFree.next=new k(this)}function s(e){return C=C||n(29),this instanceof s||this instanceof C?(this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void R.call(this)):new s(e)}function a(e,t){var n=new Error("write after end");e.emit("error",n),x(t,n)}function c(e,t,n,r){var i=!0;if(!E.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),x(r,o),i=!1}return i}function u(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new E(t,n)),t}function f(e,t,n,r,o){n=u(t,n,r),E.isBuffer(n)&&(r="buffer");var s=t.objectMode?1:n.length;t.length+=s;var a=t.length<t.highWaterMark;if(a||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest=new i(n,r,o),c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else l(e,t,!1,s,n,r,o);return a}function l(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function h(e,t,n,r,i){--t.pendingcb,n?x(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function p(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(d(n),t)h(e,n,r,t,i);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||m(e,n),r?S(g,e,n,o,i):g(e,n,o,i)}}function g(e,t,n,r){n||v(e,t),t.pendingcb--,r(),w(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;l(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,t.corkedRequestsFree=o.next,o.next=null}else{for(;n;){var a=n.chunk,c=n.encoding,u=n.callback,f=t.objectMode?1:a.length;if(l(e,t,!1,f,a,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function w(e,t){var n=y(t);return n&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),n}function _(e,t,n){t.ending=!0,w(e,t),n&&(t.finished?x(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function k(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}e.exports=s;var x=n(30),S=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:x,E=n(9).Buffer;s.WritableState=o;var M=n(31);M.inherits=n(12);var R,j={deprecate:n(36)};!function(){try{R=n(5)}catch(e){}finally{R||(R=n(2).EventEmitter)}}();var E=n(9).Buffer;M.inherits(s,R);var C;o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:j.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var C;s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},s.prototype.write=function(e,t,n){var i=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),E.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=r),i.ended?a(this,n):c(this,i,e,n)&&(i.pendingcb++,o=f(this,i,e,t,n)),o},s.prototype.cork=function(){var e=this._writableState;e.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||m(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},s.prototype._write=function(e,t,n){n(new Error("not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||_(this,r,n)}},function(e,t,n){e.exports=n(13).deprecate},function(e,t){function n(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}e.exports=n},function(e,t){function n(e){return[0,1,2].map(function(t){return[0,1].map(function(n){return[0,1].map(function(i){var o=new Buffer(1);return o.writeUInt8(r.codes[e]<<r.CMD_SHIFT|(n?r.DUP_MASK:0)|t<<r.QOS_SHIFT|i,0,!0),o})})})}var r=e.exports;r.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"reserved"},r.codes={};for(var i in r.types){var o=r.types[i];r.codes[o]=i}r.CMD_SHIFT=4,r.CMD_MASK=240,r.DUP_MASK=8,r.QOS_MASK=3,r.QOS_SHIFT=1,r.RETAIN_MASK=1,r.LENGTH_MASK=127,r.LENGTH_FIN_MASK=128,r.SESSIONPRESENT_MASK=1,r.SESSIONPRESENT_HEADER=new Buffer([r.SESSIONPRESENT_MASK]),r.CONNACK_HEADER=new Buffer([r.codes.connack<<r.CMD_SHIFT]),r.USERNAME_MASK=128,r.PASSWORD_MASK=64,r.WILL_RETAIN_MASK=32,r.WILL_QOS_MASK=24,r.WILL_QOS_SHIFT=3,r.WILL_FLAG_MASK=4,r.CLEAN_SESSION_MASK=2,r.CONNECT_HEADER=new Buffer([r.codes.connect<<r.CMD_SHIFT]),r.PUBLISH_HEADER=n("publish"),r.SUBSCRIBE_HEADER=n("subscribe"),r.UNSUBSCRIBE_HEADER=n("unsubscribe"),r.ACKS={unsuback:n("unsuback"),puback:n("puback"),pubcomp:n("pubcomp"),pubrel:n("pubrel"),pubrec:n("pubrec")},r.SUBACK_HEADER=new Buffer([r.codes.suback<<r.CMD_SHIFT]),r.VERSION3=new Buffer([3]),r.VERSION4=new Buffer([4]),r.QOS=[0,1,2].map(function(e){return new Buffer([e])}),r.EMPTY={pingreq:new Buffer([r.codes.pingreq<<4,0]),pingresp:new Buffer([r.codes.pingresp<<4,0]),disconnect:new Buffer([r.codes.disconnect<<4,0])}},function(e,t,n){"use strict";function r(e){var t=new i;return o(e,t),t.concat()}function i(){this._array=new Array(20),this._i=0}var o=n(40),s=n(2).EventEmitter,a=n(12);a(i,s),i.prototype.write=function(e){return this._array[this._i++]=e,!0},i.prototype.concat=function(){var e,t,n=0,r=new Array(this._array.length),i=this._array,o=0;for(e=0;e<i.length&&i[e];e++)"string"!=typeof i[e]?r[e]=i[e].length:r[e]=Buffer.byteLength(i[e]),n+=r[e];for(t=new Buffer(n),e=0;e<i.length&&i[e];e++)"string"!=typeof i[e]?(i[e].copy(t,o),o+=r[e]):(t.write(i[e],o),o+=r[e]);return t},e.exports=r},function(e,t,n){"use strict";function r(e,t){switch(t.cork&&(t.cork(),S(i,t)),e.cmd){case"connect":return o(e,t);case"connack":return s(e,t);case"publish":return a(e,t);case"puback":case"pubrec":case"pubrel":case"pubcomp":case"unsuback":return c(e,t);case"subscribe":return u(e,t);case"suback":return f(e,t);case"unsubscribe":return l(e,t);case"pingreq":case"pingresp":case"disconnect":return h(e,t);default:return t.emit("error",new Error("Unknown command")),!1}}function i(e){e.uncork()}function o(e,t){var n=e||{},r=n.protocolId||"MQTT",i=n.protocolVersion||4,o=n.will,s=n.clean,a=n.keepalive||0,c=n.clientId||"",u=n.username,f=n.password;void 0===s&&(s=!0);var l=0;if(!r||"string"!=typeof r&&!Buffer.isBuffer(r))return t.emit("error",new Error("Invalid protocol id")),!1;if(l+=r.length+2,3!==i&&4!==i)return t.emit("error",new Error("Invalid protocol version")),!1;if(l+=1,"string"!=typeof c&&!Buffer.isBuffer(c)||!c&&4!==i||!c&&!s){if(i<4)return t.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*s===0)return t.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else l+=c.length+2;if("number"!=typeof a||a<0||a>65535||a%1!==0)return t.emit("error",new Error("Invalid keepalive")),!1;if(l+=2,l+=1,o){if("object"!=typeof o)return t.emit("error",new Error("Invalid will")),!1;if(!o.topic||"string"!=typeof o.topic)return t.emit("error",new Error("Invalid will topic")),!1;if(l+=Buffer.byteLength(o.topic)+2,o.payload&&o.payload){if(!(o.payload.length>=0))return t.emit("error",new Error("Invalid will payload")),!1;l+="string"==typeof o.payload?Buffer.byteLength(o.payload)+2:o.payload.length+2}else l+=2}if(u){if(!u.length)return t.emit("error",new Error("Invalid username")),!1;l+=Buffer.byteLength(u)+2}if(f){if(!f.length)return t.emit("error",new Error("Invalid password")),!1;l+=b(f)+2}t.write(w.CONNECT_HEADER),g(t,l),y(t,r),t.write(4===i?w.VERSION4:w.VERSION3);var h=0;return h|=u?w.USERNAME_MASK:0,h|=f?w.PASSWORD_MASK:0,h|=o&&o.retain?w.WILL_RETAIN_MASK:0,h|=o&&o.qos?o.qos<<w.WILL_QOS_SHIFT:0,h|=o?w.WILL_FLAG_MASK:0,h|=s?w.CLEAN_SESSION_MASK:0,t.write(new Buffer([h])),m(t,a),y(t,c),o&&(v(t,o.topic),y(t,o.payload)),u&&y(t,u),f&&y(t,f),!0}function s(e,t){var n=e||{},r=n.returnCode;return"number"!=typeof r?(t.emit("error",new Error("Invalid return code")),!1):(t.write(w.CONNACK_HEADER),g(t,2),t.write(e.sessionPresent?w.SESSIONPRESENT_HEADER:k),t.write(new Buffer([r])))}function a(e,t){var n=e||{},r=n.qos||0,i=n.retain?w.RETAIN_MASK:0,o=n.topic,s=n.payload||_,a=n.messageId,c=0;if("string"==typeof o)c+=Buffer.byteLength(o)+2;else{if(!Buffer.isBuffer(o))return t.emit("error",new Error("Invalid topic")),!1;c+=o.length+2}return c+=Buffer.isBuffer(s)?s.length:Buffer.byteLength(s),r&&"number"!=typeof a?(t.emit("error",new Error("Invalid message id")),!1):(r&&(c+=2),t.write(w.PUBLISH_HEADER[r][e.dup?1:0][i?1:0]),g(t,c),m(t,b(o)),t.write(o),r>0&&m(t,a),t.write(s))}function c(e,t){var n=e||{},r=n.cmd||"puback",i=n.messageId,o=n.dup&&"pubrel"===r?w.DUP_MASK:0,s=0;return"pubrel"===r&&(s=1),"number"!=typeof i?(t.emit("error",new Error("Invalid message id")),!1):(t.write(w.ACKS[r][s][o][0]),g(t,2),m(t,i))}function u(e,t){var n=e||{},r=n.dup?w.DUP_MASK:0,i=n.messageId,o=n.subscriptions,s=0;if("number"!=typeof i)return t.emit("error",new Error("Invalid message id")),!1;if(s+=2,"object"!=typeof o||!o.length)return t.emit("error",new Error("Invalid subscriptions")),!1;for(var a=0;a<o.length;a+=1){var c=o[a].topic,u=o[a].qos;if("string"!=typeof c)return t.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof u)return t.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;s+=Buffer.byteLength(c)+2+1}t.write(w.SUBSCRIBE_HEADER[1][r?1:0][0]),g(t,s),m(t,i);for(var f=!0,l=0;l<o.length;l++){var h=o[l],d=h.topic,p=h.qos;v(t,d),f=t.write(w.QOS[p])}return f}function f(e,t){var n=e||{},r=n.messageId,i=n.granted,o=0;if("number"!=typeof r)return t.emit("error",new Error("Invalid message id")),!1;if(o+=2,"object"!=typeof i||!i.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var s=0;s<i.length;s+=1){if("number"!=typeof i[s])return t.emit("error",new Error("Invalid qos vector")),!1;o+=1}return t.write(w.SUBACK_HEADER),g(t,o),m(t,r),t.write(new Buffer(i))}function l(e,t){var n=e||{},r=n.messageId,i=n.dup?w.DUP_MASK:0,o=n.unsubscriptions,s=0;if("number"!=typeof r)return t.emit("error",new Error("Invalid message id")),!1;if(s+=2,"object"!=typeof o||!o.length)return t.emit("error",new Error("Invalid unsubscriptions")),!1;for(var a=0;a<o.length;a+=1){if("string"!=typeof o[a])return t.emit("error",new Error("Invalid unsubscriptions")),!1;s+=Buffer.byteLength(o[a])+2}t.write(w.UNSUBSCRIBE_HEADER[1][i?1:0][0]),
g(t,s),m(t,r);for(var c=!0,u=0;u<o.length;u++)c=v(t,o[u]);return c}function h(e,t){return t.write(w.EMPTY[e.cmd])}function d(e){return e>=0&&e<128?1:e>=128&&e<16384?2:e>=16384&&e<2097152?3:e>=2097152&&e<268435456?4:0}function p(e){var t=0,n=0,r=new Buffer(d(e));do t=e%128|0,e=e/128|0,e>0&&(t|=128),r.writeUInt8(t,n++,!0);while(e>0);return r}function g(e,t){var n=E[t];n||(n=p(t),t<16384&&(E[t]=n)),e.write(n)}function v(e,t){var n=Buffer.byteLength(t);m(e,n),e.write(t,"utf8")}function m(e,t){return e.write(x[t])}function y(e,t){t&&"string"==typeof t?v(e,t):t?(m(e,t.length),e.write(t)):m(e,0)}function b(e){return e?Buffer.isBuffer(e)?e.length:Buffer.byteLength(e):0}var w=n(38),_=new Buffer(0),k=new Buffer([0]),x=n(41),S=n(30),E={};e.exports=r},function(e,t){"use strict";for(var n,r=65536,i={},o=0;o<r;o++)n=new Buffer(2),n.writeUInt8(o>>8,0,!0),n.writeUInt8(255&o,1,!0),i[o]=n;e.exports=i},function(e,t){"use strict";function n(e,t,n){var r=this;this._callback=e,this._args=n,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e||(e=r._interval),r._interval&&clearInterval(r._interval),r._interval=setInterval(r._callback,e,r._args)},this.clear=function(){r._interval&&(clearInterval(r._interval),r._interval=void 0)},this.destroy=function(){r._interval&&clearInterval(r._interval),r._callback=void 0,r._interval=void 0,r._args=void 0}}function r(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new n(arguments[0],arguments[1],e)}e.exports=r},function(e,t){"use strict";function n(e){for(var t=e.split("/"),n=0;n<t.length;n++)if("+"!==t[n]){if("#"===t[n])return n===t.length-1;if(t[n].indexOf("+")!==-1||t[n].indexOf("#")!==-1)return!1}return!0}function r(e){for(var t=0;t<e.length;t++)if(!n(e[t]))return e[t];return null}e.exports={validateTopics:r}},function(e,t,n){"use strict";function r(e){var t;e.auth&&(t=e.auth.match(/^(.+):(.+)$/),t?(e.username=t[1],e.password=t[2]):e.username=e.auth)}function i(e,t){function n(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.hostname=t.host,e._reconnectCount++),c[t.protocol](e,t)}if("object"!=typeof e||t||(t=e,e=null),t=t||{},e){if(t=a(s.parse(e,!0),t),null===t.protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}if(r(t),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(["mqtts","wss"].indexOf(t.protocol)===-1)switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;default:throw new Error('Unknown protocol for secure connection: "'+t.protocol+'"!')}}if(c[t.protocol]||(t.protocol=u.filter(function(e){return"function"==typeof c[e]})[0]),t.clean===!1&&!t.clientId)throw new Error("Missing clientId for unclean clients");return new o(n,t)}var o=n(1),s=n(45),a=n(46),c={},u=[];"browser"!==process.title&&(c.mqtt=n(47),c.tcp=n(47),c.ssl=n(49),c.tls=n(49),c.mqtts=n(49)),c.ws=n(51),c.wss=n(51),u=["mqtt","mqtts","ws","wss"],e.exports=i,e.exports.connect=i,e.exports.MqttClient=o},function(e,t){e.exports=n(27)},function(e,t){function n(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e}e.exports=n;var r=Object.prototype.hasOwnProperty},function(e,t,n){"use strict";function r(e,t){var n,r;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",n=t.port,r=t.hostname,i.createConnection(n,r)}var i=n(48);e.exports=r},function(e,t){e.exports=n(22)},function(e,t,n){"use strict";function r(e,t){function n(n){t.rejectUnauthorized&&e.emit("error",n),r.end()}var r;return t.port=t.port||8883,t.host=t.hostname||t.host||"localhost",t.rejectUnauthorized=t.rejectUnauthorized!==!1,r=i.connect(t),r.on("secureConnect",function(){t.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",n)}),r.on("error",n),r}var i=n(50);e.exports=r},function(e,t){e.exports=n(26)},function(e,t,n){"use strict";function r(e,t){var n={protocol:"mqtt"},r=t.hostname||"localhost",i=t.path||"/";t.port||("wss"===t.protocol?t.port=443:t.port=80);var s=t.protocol+"://"+r+":"+t.port+i;return"MQIsdp"===t.protocolId&&3===t.protocolVersion&&(n.protocol="mqttv3.1"),"wss"===t.protocol&&a.forEach(function(e){t.hasOwnProperty(e)&&(n[e]=t[e])}),o(s,n)}function i(e,t){var n,r,i={protocol:"mqtt"};if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");return r=s.parse(document.URL),t.protocol||("https:"===r.protocol?t.protocol="wss":t.protocol="ws"),t.hostname||(t.hostname=t.host),t.hostname||(t.hostname=r.hostname,t.port||(t.port=r.port)),"MQIsdp"===t.protocolId&&3===t.protocolVersion&&(i.protocol="mqttv3.1"),t.port||("wss"===t.protocol?t.port=443:t.port=80),t.path||(t.path="/"),n=t.protocol+"://"+t.hostname+":"+t.port+t.path,o(n,i)}var o=n(52),s=n(45),a=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];"browser"!==process.title?e.exports=r:e.exports=i},function(e,t,n){var r=n(53);e.exports=n(76),e.exports.Server=r,e.exports.createServer=r},function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);o.call(this,e);var n=!1;this.on("newListener",function(t){n||"stream"!==t||(n=!0,this.on("connection",function(t){this.emit("stream",s(t,e))}))}),t&&this.on("stream",t)}var i=n(12),o=n(54).Server,s=n(76);e.exports=r,i(r,o)},function(e,t,n){"use strict";/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var r=e.exports=n(55);r.Server=n(75),r.Sender=n(62),r.Receiver=n(68),r.createServer=function(e,t){var n=new r.Server(e);return"function"==typeof t&&n.on("connection",t),n},r.connect=r.createConnection=function(e,t){var n=new r(e);return"function"==typeof t&&n.on("open",t),n}},function(e,t,n){"use strict";function r(e,t,n){return this instanceof r==0?new r(e,t,n):(C.call(this),t&&!Array.isArray(t)&&"object"==typeof t&&(n=t,t=null),"string"==typeof t&&(t=[t]),Array.isArray(t)||(t=[]),this._socket=null,this._ultron=null,this._closeReceived=!1,this.bytesReceived=0,this.readyState=null,this.supports={},this.extensions={},this._binaryType="nodebuffer",void(Array.isArray(e)?c.apply(this,e.concat(n)):u.apply(this,[e,t,n])))}function i(e,t,n){this.type="message",this.data=e,this.target=n,this.binary=t}function o(e,t,n){this.type="close",this.wasClean="undefined"==typeof e||1e3===e,this.code=e,this.reason=t,this.target=n}function s(e){this.type="open",this.target=e}function a(e,t,n){var r=t;return t&&(e&&443!=n||!e&&80!=n)&&(r=r+":"+n),r}function c(e,t,n,i){i=new k({protocolVersion:A,protocol:null,extensions:{},maxPayload:0}).merge(i),this.protocol=i.value.protocol,this.protocolVersion=i.value.protocolVersion,this.extensions=i.value.extensions,this.supports.binary="hixie-76"!==this.protocolVersion,this.upgradeReq=e,this.readyState=r.CONNECTING,this._isServer=!0,this.maxPayload=i.value.maxPayload,"hixie-76"===i.value.protocolVersion?f.call(this,M,E,t,n):f.call(this,S,x,t,n)}function u(e,t,n){if(n=new k({origin:null,protocolVersion:A,host:null,headers:null,protocol:t.join(","),agent:null,pfx:null,key:null,passphrase:null,cert:null,ca:null,ciphers:null,rejectUnauthorized:null,perMessageDeflate:!0,localAddress:null}).merge(n),8!==n.value.protocolVersion&&13!==n.value.protocolVersion)throw new Error("unsupported protocol version");var i=g.parse(e),o="ws+unix:"===i.protocol;if(!i.host&&!o)throw new Error("invalid url");var s,c="wss:"===i.protocol||"https:"===i.protocol,u=c?y:m,l=i.port||(c?443:80),h=i.auth,d={};n.value.perMessageDeflate&&(s=new j(typeof n.value.perMessageDeflate!==!0?n.value.perMessageDeflate:{},!1),d[j.extensionName]=s.offer()),this._isServer=!1,this.url=e,this.protocolVersion=n.value.protocolVersion,this.supports.binary="hixie-76"!==this.protocolVersion;var v=new Buffer(n.value.protocolVersion+"-"+Date.now()).toString("base64"),w=b.createHash("sha1");w.update(v+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var _=w.digest("base64"),E=n.value.agent,M=a(c,i.hostname,l),C={port:l,host:i.hostname,headers:{Connection:"Upgrade",Upgrade:"websocket",Host:M,"Sec-WebSocket-Version":n.value.protocolVersion,"Sec-WebSocket-Key":v}};if(h&&(C.headers.Authorization="Basic "+new Buffer(h).toString("base64")),n.value.protocol&&(C.headers["Sec-WebSocket-Protocol"]=n.value.protocol),n.value.host&&(C.headers.Host=n.value.host),n.value.headers)for(var B in n.value.headers)n.value.headers.hasOwnProperty(B)&&(C.headers[B]=n.value.headers[B]);Object.keys(d).length&&(C.headers["Sec-WebSocket-Extensions"]=R.format(d)),(n.isDefinedAndNonNull("pfx")||n.isDefinedAndNonNull("key")||n.isDefinedAndNonNull("passphrase")||n.isDefinedAndNonNull("cert")||n.isDefinedAndNonNull("ca")||n.isDefinedAndNonNull("ciphers")||n.isDefinedAndNonNull("rejectUnauthorized"))&&(n.isDefinedAndNonNull("pfx")&&(C.pfx=n.value.pfx),n.isDefinedAndNonNull("key")&&(C.key=n.value.key),n.isDefinedAndNonNull("passphrase")&&(C.passphrase=n.value.passphrase),n.isDefinedAndNonNull("cert")&&(C.cert=n.value.cert),n.isDefinedAndNonNull("ca")&&(C.ca=n.value.ca),n.isDefinedAndNonNull("ciphers")&&(C.ciphers=n.value.ciphers),n.isDefinedAndNonNull("rejectUnauthorized")&&(C.rejectUnauthorized=n.value.rejectUnauthorized),E||(E=new u.Agent(C))),C.path=i.path||"/",E&&(C.agent=E),o&&(C.socketPath=i.pathname),n.value.localAddress&&(C.localAddress=n.value.localAddress),n.value.origin&&(n.value.protocolVersion<13?C.headers["Sec-WebSocket-Origin"]=n.value.origin:C.headers.Origin=n.value.origin);var L=this,O=u.request(C);O.on("error",function(e){L.emit("error",e),p.call(L,e)}),O.once("response",function(e){var t;L.emit("unexpected-response",O,e)||(t=new Error("unexpected server response ("+e.statusCode+")"),O.abort(),L.emit("error",t)),p.call(L,t)}),O.once("upgrade",function(e,t,i){if(L.readyState===r.CLOSED)return L.emit("close"),L.removeAllListeners(),void t.end();var o=e.headers["sec-websocket-accept"];if("undefined"==typeof o||o!==_)return L.emit("error","invalid server key"),L.removeAllListeners(),void t.end();var a=e.headers["sec-websocket-protocol"],c=(n.value.protocol||"").split(/, */),u=null;if(!n.value.protocol&&a?u="server sent a subprotocol even though none requested":n.value.protocol&&!a?u="server sent no subprotocol even though requested":a&&c.indexOf(a)===-1&&(u="server responded with an invalid protocol"),u)return L.emit("error",u),L.removeAllListeners(),void t.end();a&&(L.protocol=a);var l=R.parse(e.headers["sec-websocket-extensions"]);if(s&&l[j.extensionName]){try{s.accept(l[j.extensionName])}catch(e){return L.emit("error","invalid extension parameter"),L.removeAllListeners(),void t.end()}L.extensions[j.extensionName]=s}f.call(L,S,x,t,i),O.removeAllListeners(),O=null,E=null}),O.end(),this.readyState=r.CONNECTING}function f(e,t,n,i){function o(e){c||u.readyState===r.CLOSED||(c=!0,n.removeListener("data",o),a.on("data",s),i&&i.length>0&&(s(i),i=null),e&&s(e))}function s(e){u.bytesReceived+=e.length,u._receiver.add(e)}var a=this._ultron=new _(n),c=!1,u=this;n.setTimeout(0),n.setNoDelay(!0),this._receiver=new e(this.extensions,this.maxPayload),this._socket=n,a.on("end",p.bind(this)),a.on("close",p.bind(this)),a.on("error",p.bind(this)),a.on("data",o),process.nextTick(o),u._receiver.ontext=function(e,t){t=t||{},u.emit("message",e,t)},u._receiver.onbinary=function(e,t){t=t||{},t.binary=!0,u.emit("message",e,t)},u._receiver.onping=function(e,t){t=t||{},u.pong(e,{mask:!u._isServer,binary:t.binary===!0},!0),u.emit("ping",e,t)},u._receiver.onpong=function(e,t){u.emit("pong",e,t||{})},u._receiver.onclose=function(e,t,n){n=n||{},u._closeReceived=!0,u.close(e,t)},u._receiver.onerror=function(e,t){u.close("undefined"!=typeof t?t:1002,""),u.emit("error",e instanceof Error?e:new Error(e))},this._sender=new t(n,this.extensions),this._sender.on("error",function(e){u.close(1002,""),u.emit("error",e)}),this.readyState=r.OPEN,this.emit("open")}function l(e){e._queue=e._queue||[]}function h(e){var t=e._queue;if("undefined"!=typeof t){delete e._queue;for(var n=0,r=t.length;n<r;++n)t[n]()}}function d(e,t,n,i){t.on("data",function(t){return e.readyState!==r.OPEN?void("function"==typeof i?i(new Error("not opened")):(delete e._queue,e.emit("error",new Error("not opened")))):(n.fin=!1,void e._sender.send(t,n))}),t.on("end",function(){return e.readyState!==r.OPEN?void("function"==typeof i?i(new Error("not opened")):(delete e._queue,e.emit("error",new Error("not opened")))):(n.fin=!0,e._sender.send(null,n),void("function"==typeof i&&i(null)))})}function p(e){if(this.readyState!==r.CLOSED){if(this.readyState=r.CLOSED,clearTimeout(this._closeTimer),this._closeTimer=null,!e&&this._closeReceived||(this._closeCode=1006),this.emit("close",this._closeCode||1e3,this._closeMessage||""),this._socket){this._ultron&&this._ultron.destroy(),this._socket.on("error",function(){try{this.destroy()}catch(e){}});try{e?this._socket.destroy():this._socket.end()}catch(e){}this._socket=null,this._ultron=null}this._sender&&(this._sender.removeAllListeners(),this._sender=null),this._receiver&&(this._receiver.cleanup(),this._receiver=null),this.extensions[j.extensionName]&&this.extensions[j.extensionName].cleanup(),this.extensions=null,this.removeAllListeners(),this.on("error",function(){}),delete this._queue}}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var g=n(45),v=n(13),m=n(56),y=n(57),b=n(58),w=n(5),_=n(59),k=n(60),x=n(62),S=n(68),E=n(72),M=n(73),R=n(74),j=n(66),C=n(2).EventEmitter,A=13,B=3e4;v.inherits(r,C),["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e,t){r.prototype[e]=r[e]=t}),r.prototype.close=function(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING)return void(this.readyState=r.CLOSED);if(this.readyState===r.CLOSING)return void(this._closeReceived&&this._isServer&&this.terminate());var n=this;try{this.readyState=r.CLOSING,this._closeCode=e,this._closeMessage=t;var i=!this._isServer;this._sender.close(e,t,i,function(e){e&&n.emit("error",e),n._closeReceived&&n._isServer?n.terminate():(clearTimeout(n._closeTimer),n._closeTimer=setTimeout(p.bind(n,!0),B))})}catch(e){this.emit("error",e)}}},r.prototype.pause=function(){if(this.readyState!==r.OPEN)throw new Error("not opened");return this._socket.pause()},r.prototype.ping=function(e,t,n){if(this.readyState!==r.OPEN){if(n===!0)return;throw new Error("not opened")}t=t||{},"undefined"==typeof t.mask&&(t.mask=!this._isServer),this._sender.ping(e,t)},r.prototype.pong=function(e,t,n){if(this.readyState!==r.OPEN){if(n===!0)return;throw new Error("not opened")}t=t||{},"undefined"==typeof t.mask&&(t.mask=!this._isServer),this._sender.pong(e,t)},r.prototype.resume=function(){if(this.readyState!==r.OPEN)throw new Error("not opened");return this._socket.resume()},r.prototype.send=function(e,t,n){if("function"==typeof t&&(n=t,t={}),this.readyState!==r.OPEN){if("function"!=typeof n)throw new Error("not opened");return void n(new Error("not opened"))}if(e||(e=""),this._queue){var i=this;return void this._queue.push(function(){i.send(e,t,n)})}t=t||{},t.fin=!0,"undefined"==typeof t.binary&&(t.binary=e instanceof ArrayBuffer||e instanceof Buffer||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array),"undefined"==typeof t.mask&&(t.mask=!this._isServer),"undefined"==typeof t.compress&&(t.compress=!0),this.extensions[j.extensionName]||(t.compress=!1);var o="function"==typeof w.Readable?w.Readable:w.Stream;if(e instanceof o){l(this);var i=this;d(this,e,t,function(e){process.nextTick(function(){h(i)}),"function"==typeof n&&n(e)})}else this._sender.send(e,t,n)},r.prototype.stream=function(e,t){function n(o,s){try{if(i.readyState!==r.OPEN)throw new Error("not opened");e.fin=s===!0,i._sender.send(o,e),s?h(i):process.nextTick(t.bind(null,null,n))}catch(e){"function"==typeof t?t(e):(delete i._queue,i.emit("error",e))}}"function"==typeof e&&(t=e,e={});var i=this;if("function"!=typeof t)throw new Error("callback must be provided");if(this.readyState!==r.OPEN){if("function"!=typeof t)throw new Error("not opened");return void t(new Error("not opened"))}return this._queue?void this._queue.push(function(){i.stream(e,t)}):(e=e||{},"undefined"==typeof e.mask&&(e.mask=!this._isServer),"undefined"==typeof e.compress&&(e.compress=!0),this.extensions[j.extensionName]||(e.compress=!1),l(this),void process.nextTick(t.bind(null,null,n)))},r.prototype.terminate=function(){if(this.readyState!==r.CLOSED)if(this._socket){this.readyState=r.CLOSING;try{this._socket.end()}catch(e){return void p.call(this,!0)}this._closeTimer&&clearTimeout(this._closeTimer),this._closeTimer=setTimeout(p.bind(this,!0),B)}else this.readyState===r.CONNECTING&&p.call(this,!0)},Object.defineProperty(r.prototype,"bufferedAmount",{get:function(){var e=0;return this._socket&&(e=this._socket.bufferSize||0),e}}),Object.defineProperty(r.prototype,"binaryType",{get:function(){return this._binaryType},set:function(e){if("arraybuffer"!==e&&"nodebuffer"!==e)throw new SyntaxError('unsupported binaryType: must be either "nodebuffer" or "arraybuffer"');this._binaryType=e}}),["open","error","close","message"].forEach(function(e){Object.defineProperty(r.prototype,"on"+e,{get:function(){var t=this.listeners(e)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(e),this.addEventListener(e,t)}})}),r.prototype.addEventListener=function(e,t){function n(e,n){n.binary&&"arraybuffer"===this.binaryType&&(e=new Uint8Array(e).buffer),t.call(u,new i(e,!!n.binary,u))}function r(e,n){t.call(u,new o(e,n,u))}function a(e){e.type="error",e.target=u,t.call(u,e)}function c(){t.call(u,new s(u))}var u=this;"function"==typeof t&&("message"===e?(n._listener=t,this.on(e,n)):"close"===e?(r._listener=t,this.on(e,r)):"error"===e?(a._listener=t,this.on(e,a)):"open"===e?(c._listener=t,this.on(e,c)):this.on(e,t))},e.exports=r,e.exports.buildHostHeader=a},function(e,t){e.exports=n(6)},function(e,t){e.exports=n(3)},function(e,t){e.exports=n(21)},function(e,t){"use strict";function n(e){return this instanceof n?(this.id=i++,void(this.ee=e)):new n(e)}var r=Object.prototype.hasOwnProperty,i=0;n.prototype.on=function(e,t,n){return t.__ultron=this.id,this.ee.on(e,t,n),this},n.prototype.once=function(e,t,n){return t.__ultron=this.id,this.ee.once(e,t,n),this},n.prototype.remove=function(){var e,t=arguments;if(1===t.length&&"string"==typeof t[0])t=t[0].split(/[, ]+/);else if(!t.length){t=[];for(e in this.ee._events)r.call(this.ee._events,e)&&t.push(e)}for(var n=0;n<t.length;n++)for(var i=this.ee.listeners(t[n]),o=0;o<i.length;o++){if(e=i[o],e.listener){if(e.listener.__ultron!==this.id)continue;delete e.listener.__ultron}else{if(e.__ultron!==this.id)continue;delete e.__ultron}this.ee.removeListener(t[n],e)}return this},n.prototype.destroy=function(){return!!this.ee&&(this.remove(),this.ee=null,!0)},e.exports=n},function(e,t,n){function r(e){var t={},n=this.value={};Object.keys(e).forEach(function(r){t[r]=e[r],Object.defineProperty(n,r,{get:function(){return t[r]},configurable:!1,enumerable:!0})}),this.reset=function(){return Object.keys(e).forEach(function(n){t[n]=e[n]}),this},this.merge=function(e,n){if(e=e||{},"[object Array]"===Object.prototype.toString.call(n)){for(var r=[],i=0,o=n.length;i<o;++i){var s=n[i];s in e||r.push(s)}if(r.length>0)throw r.length>1?new Error("options "+r.slice(0,r.length-1).join(", ")+" and "+r[r.length-1]+" must be defined"):new Error("option "+r[0]+" must be defined")}return Object.keys(e).forEach(function(n){n in t&&(t[n]=e[n])}),this},this.copy=function(t){var r={};return Object.keys(e).forEach(function(e){t.indexOf(e)!==-1&&(r[e]=n[e])}),r},this.read=function(e,t){if("function"==typeof t){var n=this;i.readFile(e,function(e,r){if(e)return t(e);var i=JSON.parse(r);n.merge(i),t()})}else{var r=JSON.parse(i.readFileSync(e));this.merge(r)}return this},this.isDefined=function(e){return"undefined"!=typeof n[e]},this.isDefinedAndNonNull=function(e){return"undefined"!=typeof n[e]&&null!==n[e]},Object.freeze(n),Object.freeze(this)}/*!
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var i=n(61);e.exports=r},function(e,t){e.exports=n(2)},function(e,t,n){function r(e,t){if(this instanceof r==0)throw new TypeError("Classes can't be function-called");c.EventEmitter.call(this),this._socket=e,this.extensions=t||{},this.firstFragment=!0,this.compress=!1,this.messageHandlers=[],this.processing=!1}function i(e,t){this[t]=(65280&e)>>8,this[t+1]=255&e}function o(e,t){this[t]=(4278190080&e)>>24,this[t+1]=(16711680&e)>>16,this[t+2]=(65280&e)>>8,this[t+3]=255&e}function s(e){for(var t=new Uint8Array(e.buffer||e),n=e.byteLength||e.length,r=e.byteOffset||0,i=new Buffer(n),o=0;o<n;++o)i[o]=t[r+o];return i}function a(){return new Buffer([~~(255*Math.random()),~~(255*Math.random()),~~(255*Math.random()),~~(255*Math.random())])}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var c=n(2),u=n(13),f=(c.EventEmitter,n(63)),l=n(64).BufferUtil,h=n(66);u.inherits(r,c.EventEmitter),r.prototype.close=function(e,t,n,r){if("undefined"!=typeof e&&("number"!=typeof e||!f.isValidErrorCode(e)))throw new Error("first argument must be a valid error code number");e=e||1e3;var o=new Buffer(2+(t?Buffer.byteLength(t):0));i.call(o,e,0),o.length>2&&o.write(t,2);var s=this;this.messageHandlers.push(function(e){s.frameAndSend(8,o,!0,n),e(),"function"==typeof r&&r()}),this.flush()},r.prototype.ping=function(e,t){var n=t&&t.mask,r=this;this.messageHandlers.push(function(t){r.frameAndSend(9,e||"",!0,n),t()}),this.flush()},r.prototype.pong=function(e,t){var n=t&&t.mask,r=this;this.messageHandlers.push(function(t){r.frameAndSend(10,e||"",!0,n),t()}),this.flush()},r.prototype.send=function(e,t,n){var r=!t||t.fin!==!1,i=t&&t.mask,o=t&&t.compress,s=t&&t.binary?2:1;this.firstFragment===!1?(s=0,o=!1):(this.firstFragment=!1,this.compress=o),r&&(this.firstFragment=!0);var a=this.compress,c=this;this.messageHandlers.push(function(t){c.applyExtensions(e,r,a,function(e,a){return e?void("function"==typeof n?n(e):c.emit("error",e)):(c.frameAndSend(s,a,r,i,o,n),void t())})}),this.flush()},r.prototype.frameAndSend=function(e,t,n,r,c,u){var f=!1;if(t){Buffer.isBuffer(t)||(f=!0,!t||"undefined"==typeof t.byteLength&&"undefined"==typeof t.buffer?("number"==typeof t&&(t=t.toString()),t=new Buffer(t)):t=s(t));var h=t.length,d=r?6:2,p=h;h>=65536?(d+=8,p=127):h>125&&(d+=2,p=126);var g=h<32768||r&&!f,v=g?h+d:d,m=new Buffer(v);switch(m[0]=n?128|e:e,c&&(m[0]|=64),p){case 126:i.call(m,h,2);break;case 127:o.call(m,0,2),o.call(m,h,6)}if(r){m[1]=128|p;var y=a();if(m[d-4]=y[0],m[d-3]=y[1],m[d-2]=y[2],m[d-1]=y[3],g){l.mask(t,y,m,d,h);try{this._socket.write(m,"binary",u)}catch(e){"function"==typeof u?u(e):this.emit("error",e)}}else{l.mask(t,y,t,0,h);try{this._socket.write(m,"binary"),this._socket.write(t,"binary",u)}catch(e){"function"==typeof u?u(e):this.emit("error",e)}}}else if(m[1]=p,g){t.copy(m,d);try{this._socket.write(m,"binary",u)}catch(e){"function"==typeof u?u(e):this.emit("error",e)}}else try{this._socket.write(m,"binary"),this._socket.write(t,"binary",u)}catch(e){"function"==typeof u?u(e):this.emit("error",e)}}else try{this._socket.write(new Buffer([e|(n?128:0),0|(r?128:0)].concat(r?[0,0,0,0]:[])),"binary",u)}catch(e){"function"==typeof u?u(e):this.emit("error",e)}},r.prototype.flush=function(){if(!this.processing){var e=this.messageHandlers.shift();if(e){this.processing=!0;var t=this;e(function(){t.processing=!1,t.flush()})}}},r.prototype.applyExtensions=function(e,t,n,r){n&&e?((e.buffer||e)instanceof ArrayBuffer&&(e=s(e)),this.extensions[h.extensionName].compress(e,t,r)):r(null,e)},e.exports=r},function(e,t){/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
e.exports={isValidErrorCode:function(e){return e>=1e3&&e<=1011&&1004!=e&&1005!=e&&1006!=e||e>=3e3&&e<=4999},1e3:"normal",1001:"going away",1002:"protocol error",1003:"unsupported data",1004:"reserved",1005:"reserved for extensions",1006:"reserved for extensions",1007:"inconsistent or invalid data",1008:"policy violation",1009:"message too big",1010:"extension handshake missing",1011:"an unexpected condition prevented the request from being fulfilled"}},function(e,t,n){"use strict";/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
try{e.exports=n(!function(){var e=new Error('Cannot find module "bufferutil"');throw e.code="MODULE_NOT_FOUND",e}())}catch(t){e.exports=n(65)}},function(e,t){/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
t.BufferUtil={merge:function(e,t){for(var n=0,r=0,i=t.length;r<i;++r){var o=t[r];o.copy(e,n),n+=o.length}},mask:function(e,t,n,r,i){for(var o=t.readUInt32LE(0,!0),s=0;s<i-3;s+=4){var a=o^e.readUInt32LE(s,!0);a<0&&(a=4294967296+a),n.writeUInt32LE(a,r+s,!0)}switch(i%4){case 3:n[r+s+2]=e[s+2]^t[2];case 2:n[r+s+1]=e[s+1]^t[1];case 1:n[r+s]=e[s]^t[0];case 0:}},unmask:function(e,t){for(var n=t.readUInt32LE(0,!0),r=e.length,i=0;i<r-3;i+=4){var o=n^e.readUInt32LE(i,!0);o<0&&(o=4294967296+o),e.writeUInt32LE(o,i,!0)}switch(r%4){case 3:e[i+2]=e[i+2]^t[2];case 2:e[i+1]=e[i+1]^t[1];case 1:e[i]=e[i]^t[0];case 0:}}}},function(e,t,n){function r(e,t,n){if(this instanceof r==0)throw new TypeError("Classes can't be function-called");this._options=e||{},this._isServer=!!t,this._inflate=null,this._deflate=null,this.params=null,this._maxPayload=n||0}var i=n(67),o=[8,9,10,11,12,13,14,15],s=15,a=8;r.extensionName="permessage-deflate",r.prototype.offer=function(){var e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e},r.prototype.accept=function(e){e=this.normalizeParams(e);var t;return t=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params=t,t},r.prototype.cleanup=function(){this._inflate&&(this._inflate.writeInProgress?this._inflate.pendingClose=!0:(this._inflate.close&&this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate.writeInProgress?this._deflate.pendingClose=!0:(this._deflate.close&&this._deflate.close(),this._deflate=null))},r.prototype.acceptAsServer=function(e){var t={},n=e.some(function(e){if(t={},(this._options.serverNoContextTakeover!==!1||!e.server_no_context_takeover)&&(this._options.serverMaxWindowBits!==!1||!e.server_max_window_bits)&&!("number"==typeof this._options.serverMaxWindowBits&&"number"==typeof e.server_max_window_bits&&this._options.serverMaxWindowBits>e.server_max_window_bits)&&("number"!=typeof this._options.clientMaxWindowBits||e.client_max_window_bits))return(this._options.serverNoContextTakeover||e.server_no_context_takeover)&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),this._options.clientNoContextTakeover!==!1&&e.client_no_context_takeover&&(t.client_no_context_takeover=!0),"number"==typeof this._options.serverMaxWindowBits?t.server_max_window_bits=this._options.serverMaxWindowBits:"number"==typeof e.server_max_window_bits&&(t.server_max_window_bits=e.server_max_window_bits),"number"==typeof this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits!==!1&&"number"==typeof e.client_max_window_bits&&(t.client_max_window_bits=e.client_max_window_bits),!0},this);if(!n)throw new Error("Doesn't support the offered configuration");return t},r.prototype.acceptAsClient=function(e){var t=e[0];if(null!=this._options.clientNoContextTakeover&&this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Invalid value for "client_no_context_takeover"');if(null!=this._options.clientMaxWindowBits){if(this._options.clientMaxWindowBits===!1&&t.client_max_window_bits)throw new Error('Invalid value for "client_max_window_bits"');if("number"==typeof this._options.clientMaxWindowBits&&(!t.client_max_window_bits||t.client_max_window_bits>this._options.clientMaxWindowBits))throw new Error('Invalid value for "client_max_window_bits"')}return t},r.prototype.normalizeParams=function(e){return e.map(function(e){return Object.keys(e).forEach(function(t){var n=e[t];if(n.length>1)throw new Error("Multiple extension parameters for "+t);switch(n=n[0],t){case"server_no_context_takeover":case"client_no_context_takeover":if(n!==!0)throw new Error("invalid extension parameter value for "+t+" ("+n+")");e[t]=!0;break;case"server_max_window_bits":case"client_max_window_bits":if("string"==typeof n&&(n=parseInt(n,10),!~o.indexOf(n)))throw new Error("invalid extension parameter value for "+t+" ("+n+")");if(!this._isServer&&n===!0)throw new Error("Missing extension parameter value for "+t);e[t]=n;break;default:throw new Error("Not defined extension parameter ("+t+")")}},this),e},this)},r.prototype.decompress=function(e,t,n){function r(e){a(),n(e)}function o(e){if(void 0!==f._maxPayload&&null!==f._maxPayload&&f._maxPayload>0&&(h+=e.length,h>f._maxPayload)){l=[],a();var t={type:1009};return void n(t)}l.push(e)}function a(){f._inflate&&(f._inflate.removeListener("error",r),f._inflate.removeListener("data",o),f._inflate.writeInProgress=!1,(t&&f.params[c+"_no_context_takeover"]||f._inflate.pendingClose)&&(f._inflate.close&&f._inflate.close(),f._inflate=null))}var c=this._isServer?"client":"server";if(!this._inflate){var u=this.params[c+"_max_window_bits"];this._inflate=i.createInflateRaw({windowBits:"number"==typeof u?u:s})}this._inflate.writeInProgress=!0;var f=this,l=[],h=0;this._inflate.on("error",r).on("data",o),this._inflate.write(e),t&&this._inflate.write(new Buffer([0,0,255,255])),this._inflate.flush(function(){a(),n(null,Buffer.concat(l))})},r.prototype.compress=function(e,t,n){function r(e){c(),n(e)}function o(e){h.push(e)}function c(){l._deflate&&(l._deflate.removeListener("error",r),l._deflate.removeListener("data",o),l._deflate.writeInProgress=!1,(t&&l.params[u+"_no_context_takeover"]||l._deflate.pendingClose)&&(l._deflate.close&&l._deflate.close(),l._deflate=null))}var u=this._isServer?"server":"client";if(!this._deflate){var f=this.params[u+"_max_window_bits"];this._deflate=i.createDeflateRaw({flush:i.Z_SYNC_FLUSH,windowBits:"number"==typeof f?f:s,memLevel:this._options.memLevel||a})}this._deflate.writeInProgress=!0;var l=this,h=[];this._deflate.on("error",r).on("data",o),this._deflate.write(e),this._deflate.flush(function(){c();var e=Buffer.concat(h);t&&(e=e.slice(0,e.length-4)),n(null,e)})},e.exports=r},function(e,t){e.exports=n(28)},function(e,t,n){function r(e,t){if(this instanceof r==0)throw new TypeError("Classes can't be function-called");"number"==typeof e&&(t=e,e={});var n=-1;this.fragmentedBufferPool=new f(1024,function(e,t){return e.used+t},function(e){return n=n>=0?Math.ceil((n+e.used)/2):e.used});var i=-1;this.unfragmentedBufferPool=new f(1024,function(e,t){return e.used+t},function(e){return i=i>=0?Math.ceil((i+e.used)/2):e.used}),this.extensions=e||{},this.maxPayload=t||0,this.currentPayloadLength=0,this.state={activeFragmentedOperation:null,lastFragment:!1,masked:!1,opcode:0,fragmentedOperation:!1},this.overflow=[],this.headerBuffer=new Buffer(10),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.currentMessage=[],this.currentMessageLength=0,this.messageHandlers=[],this.expectHeader(2,this.processPacket),this.dead=!1,this.processing=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}function i(e){return(this[e]<<8)+this[e+1]}function o(e){return(this[e]<<24)+(this[e+1]<<16)+(this[e+2]<<8)+this[e+3]}function s(e,t,n,r){switch(e){default:t.copy(n,r,0,e);break;case 16:n[r+15]=t[15];case 15:n[r+14]=t[14];case 14:n[r+13]=t[13];case 13:n[r+12]=t[12];case 12:n[r+11]=t[11];case 11:n[r+10]=t[10];case 10:n[r+9]=t[9];case 9:n[r+8]=t[8];case 8:n[r+7]=t[7];case 7:n[r+6]=t[6];case 6:n[r+5]=t[5];case 5:n[r+4]=t[4];case 4:n[r+3]=t[3];case 3:n[r+2]=t[2];case 2:n[r+1]=t[1];case 1:n[r]=t[0]}}function a(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var c=(n(13),n(69).Validation),u=n(63),f=n(71),l=n(64).BufferUtil,h=n(66);e.exports=r,r.prototype.add=function(e){if(!this.dead){var t=e.length;if(0!=t){if(null==this.expectBuffer)return void this.overflow.push(e);var n=Math.min(t,this.expectBuffer.length-this.expectOffset);for(s(n,e,this.expectBuffer,this.expectOffset),this.expectOffset+=n,n<t&&this.overflow.push(e.slice(n));this.expectBuffer&&this.expectOffset==this.expectBuffer.length;){var r=this.expectBuffer;this.expectBuffer=null,this.expectOffset=0,this.expectHandler.call(this,r)}}}},r.prototype.cleanup=function(){this.dead=!0,this.overflow=null,this.headerBuffer=null,this.expectBuffer=null,this.expectHandler=null,this.unfragmentedBufferPool=null,this.fragmentedBufferPool=null,this.state=null,this.currentMessage=null,this.onerror=null,this.ontext=null,this.onbinary=null,this.onclose=null,this.onping=null,this.onpong=null},r.prototype.expectHeader=function(e,t){if(0==e)return void t(null);this.expectBuffer=this.headerBuffer.slice(this.expectOffset,this.expectOffset+e),this.expectHandler=t;for(var n=e;n>0&&this.overflow.length>0;){var r=this.overflow.pop();n<r.length&&this.overflow.push(r.slice(n));var i=Math.min(r.length,n);s(i,r,this.expectBuffer,this.expectOffset),this.expectOffset+=i,n-=i}},r.prototype.expectData=function(e,t){if(0==e)return void t(null);this.expectBuffer=this.allocateFromPool(e,this.state.fragmentedOperation),this.expectHandler=t;for(var n=e;n>0&&this.overflow.length>0;){var r=this.overflow.pop();n<r.length&&this.overflow.push(r.slice(n));var i=Math.min(r.length,n);s(i,r,this.expectBuffer,this.expectOffset),this.expectOffset+=i,n-=i}},r.prototype.allocateFromPool=function(e,t){return(t?this.fragmentedBufferPool:this.unfragmentedBufferPool).get(e)},r.prototype.processPacket=function(e){if(this.extensions[h.extensionName]){if(0!=(48&e[0]))return void this.error("reserved fields (2, 3) must be empty",1002)}else if(0!=(112&e[0]))return void this.error("reserved fields must be empty",1002);this.state.lastFragment=128==(128&e[0]),this.state.masked=128==(128&e[1]);var t=64==(64&e[0]),n=15&e[0];if(0===n){if(t)return void this.error("continuation frame cannot have the Per-message Compressed bits",1002);if(this.state.fragmentedOperation=!0,this.state.opcode=this.state.activeFragmentedOperation,1!=this.state.opcode&&2!=this.state.opcode)return void this.error("continuation frame cannot follow current opcode",1002)}else{if(n<3&&null!=this.state.activeFragmentedOperation)return void this.error("data frames after the initial data frame must have opcode 0",1002);if(n>=8&&t)return void this.error("control frames cannot have the Per-message Compressed bits",1002);this.state.compressed=t,this.state.opcode=n,this.state.lastFragment===!1?(this.state.fragmentedOperation=!0,this.state.activeFragmentedOperation=n):this.state.fragmentedOperation=!1}var r=d[this.state.opcode];"undefined"==typeof r?this.error("no handler for opcode "+this.state.opcode,1002):r.start.call(this,e)},r.prototype.endPacket=function(){this.dead||(this.state.fragmentedOperation?this.state.lastFragment&&this.fragmentedBufferPool.reset(!0):this.unfragmentedBufferPool.reset(!0),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.state.lastFragment&&this.state.opcode===this.state.activeFragmentedOperation&&(this.state.activeFragmentedOperation=null),this.currentPayloadLength=0,this.state.lastFragment=!1,this.state.opcode=null!=this.state.activeFragmentedOperation?this.state.activeFragmentedOperation:0,this.state.masked=!1,this.expectHeader(2,this.processPacket))},r.prototype.reset=function(){this.dead||(this.state={activeFragmentedOperation:null,lastFragment:!1,masked:!1,opcode:0,fragmentedOperation:!1},this.fragmentedBufferPool.reset(!0),this.unfragmentedBufferPool.reset(!0),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.overflow=[],this.currentMessage=[],this.currentMessageLength=0,this.messageHandlers=[],this.currentPayloadLength=0)},r.prototype.unmask=function(e,t,n){return null!=e&&null!=t&&l.unmask(t,e),n?t:null!=t?t.toString("utf8"):""},r.prototype.error=function(e,t){if(!this.dead)return this.reset(),"string"==typeof e?this.onerror(new Error(e),t):e.constructor==Error?this.onerror(e,t):this.onerror(new Error("An error occured"),t),this},r.prototype.flush=function(){if(!this.processing&&!this.dead){var e=this.messageHandlers.shift();if(e){this.processing=!0;var t=this;e(function(){t.processing=!1,t.flush()})}}},r.prototype.applyExtensions=function(e,t,n,r){var i=this;n?this.extensions[h.extensionName].decompress(e,t,function(e,t){if(!i.dead)return e?void r(new Error("invalid compressed data")):void r(null,t)}):r(null,e)},r.prototype.maxPayloadExceeded=function(e){if(void 0===this.maxPayload||null===this.maxPayload||this.maxPayload<1)return!1;var t=this.currentPayloadLength+e;return t<this.maxPayload?(this.currentPayloadLength=t,!1):(this.error("payload cannot exceed "+this.maxPayload+" bytes",1009),this.messageBuffer=[],this.cleanup(),!0)};var d={1:{start:function(e){var t=this,n=127&e[1];if(n<126){if(t.maxPayloadExceeded(n))return void t.error("Maximumpayload exceeded in compressed text message. Aborting...",1009);d[1].getData.call(t,n)}else 126==n?t.expectHeader(2,function(e){var n=i.call(e,0);return t.maxPayloadExceeded(n)?void t.error("Maximumpayload exceeded in compressed text message. Aborting...",1009):void d[1].getData.call(t,n)}):127==n&&t.expectHeader(8,function(e){if(0!=o.call(e,0))return void t.error("packets with length spanning more than 32 bit is currently not supported",1008);var n=o.call(e,4);return t.maxPayloadExceeded(n)?void t.error("Maximumpayload exceeded in compressed text message. Aborting...",1009):void d[1].getData.call(t,o.call(e,4))})},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){d[1].finish.call(t,r,e)})}):t.expectData(e,function(e){d[1].finish.call(t,null,e)})},finish:function(e,t){var n=this,r=this.unmask(e,t,!0)||new Buffer(0),i=a(this.state);this.messageHandlers.push(function(e){n.applyExtensions(r,i.lastFragment,i.compressed,function(t,r){if(t)return 1009===t.type?n.error("Maximumpayload exceeded in compressed text message. Aborting...",1009):n.error(t.message,1007);if(null!=r){if(!(0==n.maxPayload||n.maxPayload>0&&n.currentMessageLength+r.length<n.maxPayload))return n.currentMessage=null,n.currentMessage=[],n.currentMessageLength=0,void n.error(new Error("Maximum payload exceeded. maxPayload: "+n.maxPayload),1009);n.currentMessage.push(r),n.currentMessageLength+=r.length}if(i.lastFragment){var o=Buffer.concat(n.currentMessage);if(n.currentMessage=[],n.currentMessageLength=0,!c.isValidUTF8(o))return void n.error("invalid utf8 sequence",1007);n.ontext(o.toString("utf8"),{masked:i.masked,buffer:o})}e()})}),this.flush(),this.endPacket()}},2:{start:function(e){var t=this,n=127&e[1];if(n<126){if(t.maxPayloadExceeded(n))return void t.error("Max payload exceeded in compressed text message. Aborting...",1009);d[2].getData.call(t,n)}else 126==n?t.expectHeader(2,function(e){var n=i.call(e,0);return t.maxPayloadExceeded(n)?void t.error("Max payload exceeded in compressed text message. Aborting...",1009):void d[2].getData.call(t,n)}):127==n&&t.expectHeader(8,function(e){if(0!=o.call(e,0))return void t.error("packets with length spanning more than 32 bit is currently not supported",1008);var n=o.call(e,4,!0);return t.maxPayloadExceeded(n)?void t.error("Max payload exceeded in compressed text message. Aborting...",1009):void d[2].getData.call(t,n)})},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){d[2].finish.call(t,r,e)})}):t.expectData(e,function(e){d[2].finish.call(t,null,e)})},finish:function(e,t){var n=this,r=this.unmask(e,t,!0)||new Buffer(0),i=a(this.state);this.messageHandlers.push(function(e){n.applyExtensions(r,i.lastFragment,i.compressed,function(t,r){if(t)return 1009===t.type?n.error("Max payload exceeded in compressed binary message. Aborting...",1009):n.error(t.message,1007);if(null!=r){if(!(0==n.maxPayload||n.maxPayload>0&&n.currentMessageLength+r.length<n.maxPayload))return n.currentMessage=null,n.currentMessage=[],n.currentMessageLength=0,void n.error(new Error("Maximum payload exceeded"),1009);n.currentMessage.push(r),n.currentMessageLength+=r.length}if(i.lastFragment){var o=Buffer.concat(n.currentMessage);n.currentMessage=[],n.currentMessageLength=0,n.onbinary(o,{masked:i.masked,buffer:o})}e()})}),this.flush(),this.endPacket()}},8:{start:function(e){var t=this;if(0==t.state.lastFragment)return void t.error("fragmented close is not supported",1002);var n=127&e[1];n<126?d[8].getData.call(t,n):t.error("control frames cannot have more than 125 bytes of data",1002)},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){d[8].finish.call(t,r,e)})}):t.expectData(e,function(e){d[8].finish.call(t,null,e)})},finish:function(e,t){var n=this;t=n.unmask(e,t,!0);var r=a(this.state);this.messageHandlers.push(function(){if(t&&1==t.length)return void n.error("close packets with data must be at least two bytes long",1002);var e=t&&t.length>1?i.call(t,0):1e3;if(!u.isValidErrorCode(e))return void n.error("invalid error code",1002);var o="";if(t&&t.length>2){var s=t.slice(2);if(!c.isValidUTF8(s))return void n.error("invalid utf8 sequence",1007);o=s.toString("utf8")}n.onclose(e,o,{masked:r.masked}),n.reset()}),this.flush()}},9:{start:function(e){var t=this;if(0==t.state.lastFragment)return void t.error("fragmented ping is not supported",1002);var n=127&e[1];n<126?d[9].getData.call(t,n):t.error("control frames cannot have more than 125 bytes of data",1002)},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){d[9].finish.call(t,r,e)})}):t.expectData(e,function(e){d[9].finish.call(t,null,e)})},finish:function(e,t){var n=this;t=this.unmask(e,t,!0);var r=a(this.state);this.messageHandlers.push(function(e){n.onping(t,{masked:r.masked,binary:!0}),e()}),this.flush(),this.endPacket()}},10:{start:function(e){var t=this;if(0==t.state.lastFragment)return void t.error("fragmented pong is not supported",1002);var n=127&e[1];n<126?d[10].getData.call(t,n):t.error("control frames cannot have more than 125 bytes of data",1002)},getData:function(e){var t=this;this.state.masked?this.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){d[10].finish.call(t,r,e)})}):this.expectData(e,function(e){d[10].finish.call(t,null,e)})},finish:function(e,t){var n=this;t=n.unmask(e,t,!0);var r=a(this.state);this.messageHandlers.push(function(e){n.onpong(t,{masked:r.masked,binary:!0}),e()}),this.flush(),this.endPacket()}}}},function(e,t,n){"use strict";/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
try{e.exports=n(!function(){var e=new Error('Cannot find module "utf-8-validate"');throw e.code="MODULE_NOT_FOUND",e}())}catch(t){e.exports=n(70)}},function(e,t){/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
t.Validation={isValidUTF8:function(e){return!0}}},function(e,t,n){function r(e,t,n){if(this instanceof r==0)throw new TypeError("Classes can't be function-called");"function"==typeof e?(n=t,t=e,e=0):"undefined"==typeof e&&(e=0),this._growStrategy=(t||function(e,t){return e.used+t}).bind(null,this),this._shrinkStrategy=(n||function(t){return e}).bind(null,this),this._buffer=e?new Buffer(e):null,this._offset=0,this._used=0,this._changeFactor=0,this.__defineGetter__("size",function(){return null==this._buffer?0:this._buffer.length}),this.__defineGetter__("used",function(){return this._used})}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
n(13),r.prototype.get=function(e){if(null==this._buffer||this._offset+e>this._buffer.length){var t=new Buffer(this._growStrategy(e));this._buffer=t,this._offset=0}this._used+=e;var n=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,n},r.prototype.reset=function(e){var t=this._shrinkStrategy();t<this.size&&(this._changeFactor-=1),(e||this._changeFactor<-2)&&(this._changeFactor=0,this._buffer=t?new Buffer(t):null),this._offset=0,this._used=0},e.exports=r},function(e,t,n){function r(e){if(this instanceof r==0)throw new TypeError("Classes can't be function-called");i.EventEmitter.call(this),this.socket=e,this.continuationFrame=!1,this.isClosed=!1}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var i=n(2),o=n(13);i.EventEmitter,e.exports=r,o.inherits(r,i.EventEmitter),r.prototype.send=function(e,t,n){if(!this.isClosed){var r="string"==typeof e,i=r?Buffer.byteLength(e):e.length,o=i>127?2:1,s=0==this.continuationFrame,a=!t||!("undefined"!=typeof t.fin&&!t.fin),c=new Buffer((s?t&&t.binary?1+o:1:0)+i+(!a||t&&t.binary?0:1)),u=s?1:0;s&&(t&&t.binary?(c.write("","binary"),o>1&&c.write(String.fromCharCode(128+i/128),u++,"binary"),c.write(String.fromCharCode(127&i),u++,"binary")):c.write("\0","binary")),r?c.write(e,u,"utf8"):e.copy(c,u,0),a?(t&&t.binary||c.write("ÿ",u+i,"binary"),this.continuationFrame=!1):this.continuationFrame=!0;try{this.socket.write(c,"binary",n)}catch(e){this.error(e.toString())}}},r.prototype.close=function(e,t,n,r){if(!this.isClosed){this.isClosed=!0;try{this.continuationFrame&&this.socket.write(new Buffer([255],"binary")),this.socket.write(new Buffer([255,0]),"binary",r)}catch(e){this.error(e.toString())}}},r.prototype.ping=function(e,t){},r.prototype.pong=function(e,t){},r.prototype.error=function(e){return this.emit("error",e),this}},function(e,t,n){function r(){if(this instanceof r==0)throw new TypeError("Classes can't be function-called");this.state=o,this.buffers=[],this.messageEnd=-1,this.spanLength=0,this.dead=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}function i(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var o=(n(13),0),s=1,a=2,c=3;e.exports=r,r.prototype.add=function(e){function t(){if(n.state===o){if(2==e.length&&255==e[0]&&0==e[1])return n.reset(),void n.onclose();if(128===e[0])n.messageEnd=0,n.state=a,e=e.slice(1);else{if(0!==e[0])return void n.error("payload must start with 0x00 byte",!0);e=e.slice(1),n.state=s}}if(n.state===a){for(var t=0;t<e.length&&128&e[t];)n.messageEnd=128*n.messageEnd+(127&e[t]),++t;t<e.length&&(n.messageEnd=128*n.messageEnd+(127&e[t]),n.state=c,++t),t>0&&(e=e.slice(t))}if(n.state===c){var r=n.messageEnd-n.spanLength;return e.length>=r?(n.buffers.push(e),n.spanLength+=r,n.messageEnd=r,n.parse()):(n.buffers.push(e),void(n.spanLength+=e.length))}return n.buffers.push(e),(n.messageEnd=i(e,255))!=-1?(n.spanLength+=n.messageEnd,n.parse()):void(n.spanLength+=e.length)}if(!this.dead)for(var n=this;e;)e=t()},r.prototype.cleanup=function(){this.dead=!0,this.state=o,this.buffers=[]},r.prototype.parse=function(){for(var e=new Buffer(this.spanLength),t=0,n=0,r=this.buffers.length;n<r-1;++n){var i=this.buffers[n];i.copy(e,t),t+=i.length}var o=this.buffers[this.buffers.length-1];this.messageEnd>0&&o.copy(e,t,0,this.messageEnd),this.state!==s&&--this.messageEnd;var a=null;return this.messageEnd<o.length-1&&(a=o.slice(this.messageEnd+1)),this.reset(),this.ontext(e.toString("utf8")),a},r.prototype.error=function(e,t){if(!this.dead)return this.reset(),"string"==typeof e?this.onerror(new Error(e),t):e.constructor==Error?this.onerror(e,t):this.onerror(new Error("An error occured"),t),this},r.prototype.reset=function(e){this.dead||(this.state=o,this.buffers=[],this.messageEnd=-1,this.spanLength=0)}},function(e,t,n){function r(e){e=e||"";var t={};return e.split(",").forEach(function(e){var n=e.split(";"),r=n.shift().trim(),i=t[r]=t[r]||[],o={};n.forEach(function(e){var t=e.trim().split("="),n=t[0],r=t[1];"undefined"==typeof r?r=!0:('"'===r[0]&&(r=r.slice(1)),'"'===r[r.length-1]&&(r=r.slice(0,r.length-1))),(o[n]=o[n]||[]).push(r)}),i.push(o)}),t}function i(e){return Object.keys(e).map(function(t){var n=e[t];return o.isArray(n)||(n=[n]),n.map(function(e){return[t].concat(Object.keys(e).map(function(t){var n=e[t];return o.isArray(n)||(n=[n]),n.map(function(e){return e===!0?t:t+"="+e}).join("; ")})).join("; ")}).join(", ")}).join(", ")}var o=n(13);t.parse=r,t.format=i},function(e,t,n){function r(e,t){if(this instanceof r==0)return new r(e,t);if(u.EventEmitter.call(this),e=new h({host:"0.0.0.0",port:null,server:null,verifyClient:null,handleProtocols:null,path:null,noServer:!1,disableHixie:!1,clientTracking:!0,perMessageDeflate:!0,maxPayload:104857600}).merge(e),!e.isDefinedAndNonNull("port")&&!e.isDefinedAndNonNull("server")&&!e.value.noServer)throw new TypeError("`port` or a `server` must be provided");var n=this;if(e.isDefinedAndNonNull("port"))this._server=f.createServer(function(e,t){var n=f.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.allowHalfOpen=!1,this._server.listen(e.value.port,e.value.host,t),this._closeServer=function(){n._server&&n._server.close()};else if(e.value.server&&(this._server=e.value.server,e.value.path)){if(this._server._webSocketPaths&&e.value.server._webSocketPaths[e.value.path])throw new Error("two instances of WebSocketServer cannot listen on the same http server path");"object"!=typeof this._server._webSocketPaths&&(this._server._webSocketPaths={}),this._server._webSocketPaths[e.value.path]=1}this._server&&(this._onceServerListening=function(){n.emit("listening")},this._server.once("listening",this._onceServerListening)),"undefined"!=typeof this._server&&(this._onServerError=function(e){n.emit("error",e)},this._server.on("error",this._onServerError),this._onServerUpgrade=function(e,t,r){var i=new Buffer(r.length);r.copy(i),n.handleUpgrade(e,t,i,function(t){n.emit("connection"+e.url,t),n.emit("connection",t)})},this._server.on("upgrade",this._onServerUpgrade)),this.options=e.value,this.path=e.value.path,this.clients=[]}function i(e,t,n,r){var i=function(){try{t.destroy()}catch(e){}};if(t.on("error",i),!e.headers["sec-websocket-key"])return void a(t,400,"Bad Request");var o=parseInt(e.headers["sec-websocket-version"]);if([8,13].indexOf(o)===-1)return void a(t,400,"Bad Request");var c=e.headers["sec-websocket-protocol"],u=o<13?e.headers["sec-websocket-origin"]:e.headers.origin,h=p.parse(e.headers["sec-websocket-extensions"]),g=this,v=function(c){var u=e.headers["sec-websocket-key"],f=l.createHash("sha1");f.update(u+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11"),u=f.digest("base64");var v=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: "+u];"undefined"!=typeof c&&v.push("Sec-WebSocket-Protocol: "+c);var m={};try{m=s.call(g,h)}catch(e){return void a(t,400,"Bad Request")}if(Object.keys(m).length){var y={};Object.keys(m).forEach(function(e){y[e]=[m[e].params]}),v.push("Sec-WebSocket-Extensions: "+p.format(y))}g.emit("headers",v),t.setTimeout(0),t.setNoDelay(!0);try{t.write(v.concat("","").join("\r\n"))}catch(e){try{t.destroy()}catch(e){}return}var b=new d([e,t,n],{protocolVersion:o,protocol:c,extensions:m,maxPayload:g.options.maxPayload});g.options.clientTracking&&(g.clients.push(b),b.on("close",function(){var e=g.clients.indexOf(b);e!=-1&&g.clients.splice(e,1)})),t.removeListener("error",i),r(b)},m=function(){if("function"==typeof g.options.handleProtocols){var e=(c||"").split(/, */),n=!1;return g.options.handleProtocols(e,function(e,r){n=!0,e?v(r):a(t,401,"Unauthorized")}),void(n||a(t,501,"Could not process protocols"))}"undefined"!=typeof c?v(c.split(/, */)[0]):v()};if("function"==typeof this.options.verifyClient){var y={origin:u,secure:"undefined"!=typeof e.connection.authorized||"undefined"!=typeof e.connection.encrypted,req:e};if(2==this.options.verifyClient.length)return void this.options.verifyClient(y,function(e,n,r){"undefined"==typeof n&&(n=401),"undefined"==typeof r&&(r=f.STATUS_CODES[n]),e?m():a(t,n,r)});if(!this.options.verifyClient(y))return void a(t,401,"Unauthorized")}m()}function o(e,t,n,r){var i=function(){try{t.destroy()}catch(e){}};if(t.on("error",i),this.options.disableHixie)return void a(t,401,"Hixie support disabled");if(!e.headers["sec-websocket-key2"])return void a(t,400,"Bad Request");var o=e.headers.origin,s=this,c=function(){var c;c=e.headers["x-forwarded-host"]?e.headers["x-forwarded-host"]:e.headers.host;var u=("https"===e.headers["x-forwarded-proto"]||t.encrypted?"wss":"ws")+"://"+c+e.url,f=e.headers["sec-websocket-protocol"],h=function(){var e=["HTTP/1.1 101 Switching Protocols","Upgrade: WebSocket","Connection: Upgrade","Sec-WebSocket-Location: "+u];return"undefined"!=typeof f&&e.push("Sec-WebSocket-Protocol: "+f),"undefined"!=typeof o&&e.push("Sec-WebSocket-Origin: "+o),new Buffer(e.concat("","").join("\r\n"))},p=function(){t.setTimeout(0),t.setNoDelay(!0);var e=h();try{t.write(e,"binary",function(e){e&&t.removeListener("data",w)})}catch(e){try{t.destroy()}catch(e){}return}},g=function(n,o,c){var u=e.headers["sec-websocket-key1"],h=e.headers["sec-websocket-key2"],p=l.createHash("md5");[u,h].forEach(function(e){var n=parseInt(e.replace(/[^\d]/g,"")),r=e.replace(/[^ ]/g,"").length;return 0===r||n%r!==0?void a(t,400,"Bad Request"):(n/=r,void p.update(String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,255&n)))}),p.update(n.toString("binary")),t.setTimeout(0),t.setNoDelay(!0);try{var g=new Buffer(p.digest("binary"),"binary"),v=new Buffer(c.length+g.length);c.copy(v,0),g.copy(v,c.length),t.write(v,"binary",function(n){if(!n){var a=new d([e,t,o],{protocolVersion:"hixie-76",protocol:f});s.options.clientTracking&&(s.clients.push(a),a.on("close",function(){var e=s.clients.indexOf(a);e!=-1&&s.clients.splice(e,1)})),t.removeListener("error",i),r(a)}})}catch(e){try{t.destroy()}catch(e){}return}},v=8;if(n&&n.length>=v){var m=n.slice(0,v),y=n.length>v?n.slice(v):null;g.call(s,m,y,h())}else{var m=new Buffer(v);n.copy(m,0);var b=n.length,y=null,w=function(e){var n=Math.min(e.length,v-b);0!==n&&(e.copy(m,b,0,n),b+=n,b==v&&(t.removeListener("data",w),n<e.length&&(y=e.slice(n)),g.call(s,m,y,new Buffer(0))))};t.on("data",w),p()}};if("function"==typeof this.options.verifyClient){var u={origin:o,secure:"undefined"!=typeof e.connection.authorized||"undefined"!=typeof e.connection.encrypted,req:e};if(2==this.options.verifyClient.length){var s=this;return void this.options.verifyClient(u,function(e,n,r){"undefined"==typeof n&&(n=401),"undefined"==typeof r&&(r=f.STATUS_CODES[n]),e?c.apply(s):a(t,n,r)})}if(!this.options.verifyClient(u))return void a(t,401,"Unauthorized")}c()}function s(e){var t={},n=this.options.perMessageDeflate,r=this.options.maxPayload;if(n&&e[g.extensionName]){var i=new g(n!==!0?n:{},!0,r);i.accept(e[g.extensionName]),t[g.extensionName]=i}return t}function a(e,t,n){try{var r=["HTTP/1.1 "+t+" "+n,"Content-type: text/html"];e.write(r.concat("","").join("\r\n"))}catch(e){}finally{try{e.destroy()}catch(e){}}}/*!
		 * ws: a node.js websocket client
		 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
		 * MIT Licensed
		 */
var c=n(13),u=n(2),f=n(56),l=n(58),h=n(60),d=n(55),p=n(74),g=n(66),v=(n(50),n(45));c.inherits(r,u.EventEmitter),r.prototype.close=function(e){var t=null;try{for(var n=0,r=this.clients.length;n<r;++n)this.clients[n].terminate()}catch(e){t=e}this.path&&this._server._webSocketPaths&&(delete this._server._webSocketPaths[this.path],0==Object.keys(this._server._webSocketPaths).length&&delete this._server._webSocketPaths);try{"undefined"!=typeof this._closeServer&&this._closeServer()}finally{this._server&&(this._server.removeListener("listening",this._onceServerListening),this._server.removeListener("error",this._onServerError),this._server.removeListener("upgrade",this._onServerUpgrade)),delete this._server}if(e)e(t);else if(t)throw t},r.prototype.handleUpgrade=function(e,t,n,r){if(this.options.path){var s=v.parse(e.url);if(s&&s.pathname!==this.options.path)return}return"undefined"==typeof e.headers.upgrade||"websocket"!==e.headers.upgrade.toLowerCase()?void a(t,400,"Bad Request"):void(e.headers["sec-websocket-key1"]?o.apply(this,arguments):i.apply(this,arguments))},e.exports=r},function(e,t,n){"use strict";function r(e,t,n){function r(e,t,n){k&&"string"==typeof e&&(e=new Buffer(e,"utf8")),g.send(e,n)}function a(e,t,n){if(g.bufferedAmount>w)return void setTimeout(a,_,e,t,n);k&&"string"==typeof e&&(e=new Buffer(e,"utf8"));try{g.send(e)}catch(e){return n(e)}n()}function c(e){g.close(),e()}function u(){p.setReadable(b),p.setWritable(b),p.emit("connect")}function f(){p.end(),p.destroy()}function l(e){p.destroy(e)}function h(e){var t=e.data;t=t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):new Buffer(t),b.push(t)}function d(){g.close()}var p,g,v="browser"===process.title,m=!!global.WebSocket,y=v?a:r,b=i.obj(y,c);t&&!Array.isArray(t)&&"object"==typeof t&&(n=t,t=null,("string"==typeof n.protocol||Array.isArray(n.protocol))&&(t=n.protocol)),n||(n={});var w=n.browserBufferSize||524288,_=n.browserBufferTimeout||1e3;"object"==typeof e?g=e:(g=m&&v?new s(e,t):new s(e,t,n),g.binaryType="arraybuffer"),g.readyState===s.OPEN?p=b:(p=o.obj(),g.onopen=u),p.socket=g,g.onclose=f,g.onerror=l,g.onmessage=h,b.on("close",d);var k=n.binary||void 0===n.binary;return p}var i=n(77),o=n(88),s=n(54);e.exports=r},function(e,t,n){function r(e){s.call(this,e),this._destroyed=!1}function i(e,t,n){n(null,e)}function o(e){return function(t,n,r){return"function"==typeof t&&(r=n,n=t,t={}),"function"!=typeof n&&(n=i),"function"!=typeof r&&(r=null),e(t,n,r)}}var s=n(78),a=n(13).inherits,c=n(46);a(r,s),r.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;process.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},e.exports=o(function(e,t,n){var i=new r(e);return i._transform=t,n&&(i._flush=n),i}),e.exports.ctor=o(function(e,t,n){function i(t){return this instanceof i?(this.options=c(e,t),void r.call(this,this.options)):new i(t)}return a(i,r),i.prototype._transform=t,n&&(i.prototype._flush=n),i}),e.exports.obj=o(function(e,t,n){var i=new r(c({objectMode:!0,highWaterMark:16},e));return i._transform=t,n&&(i._flush=n),i})},function(e,t,n){e.exports=n(79)},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return i(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);a.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}e.exports=o;var a=n(80),c=n(82);c.inherits=n(12),c.inherits(o,a),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,n){"use strict";function r(e){return this instanceof r?(u.call(this,e),f.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(e)}function i(){this.allowHalfOpen||this._writableState.ended||a(o,this)}function o(e){e.end()}var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var a=n(81),c=n(82);c.inherits=n(12);var u=n(83),f=n(86);c.inherits(r,u);for(var l=s(f.prototype),h=0;h<l.length;h++){var d=l[h];r.prototype[d]||(r.prototype[d]=f.prototype[d])}},function(e,t){"use strict";function n(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,n)});case 4:return process.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick(function(){e.apply(null,i)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports=n:e.exports=process.nextTick},function(e,t){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===v(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function s(e){return"number"==typeof e}function a(e){return"string"==typeof e}function c(e){return"symbol"==typeof e}function u(e){return void 0===e}function f(e){return"[object RegExp]"===v(e)}function l(e){return"object"==typeof e&&null!==e}function h(e){return"[object Date]"===v(e)}function d(e){return"[object Error]"===v(e)||e instanceof Error}function p(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function v(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=o,t.isNumber=s,t.isString=a,t.isSymbol=c,t.isUndefined=u,t.isRegExp=f,t.isObject=l,t.isDate=h,t.isError=d,t.isFunction=p,t.isPrimitive=g,t.isBuffer=Buffer.isBuffer},function(e,t,n){"use strict";function r(e,t){I=I||n(80),e=e||{},this.objectMode=!!e.objectMode,t instanceof I&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(O||(O=n(85).StringDecoder),this.decoder=new O(e.encoding),this.encoding=e.encoding)}function i(e){return I=I||n(80),this instanceof i?(this._readableState=new r(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),void j.call(this)):new i(e)}function o(e,t,n,r,i){var o=u(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,f(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else{var c;!t.decoder||i||r||(n=t.decoder.write(n),c=!t.objectMode&&0===n.length),i||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&l(e))),d(e,t)}else i||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function a(e){return e>=T?e=T:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function c(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=a(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function u(e,t){var n=null;return R.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function f(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,l(e)}}function l(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(L("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?E(h,e):h(e))}function h(e){L("emit readable"),e.emit("readable"),b(e)}function d(e,t){t.readingMore||(t.readingMore=!0,E(p,e,t))}function p(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(L("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function g(e){return function(){var t=e._readableState;L("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&C(e,"data")&&(t.flowing=!0,b(e))}}function v(e){L("readable nexttick read 0"),e.read(0)}function m(e,t){t.resumeScheduled||(t.resumeScheduled=!0,E(y,e,t))}function y(e,t){t.reading||(L("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),b(e),t.flowing&&!t.reading&&e.read(0)}function b(e){var t=e._readableState;if(L("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function w(e,t){var n,r=t.buffer,i=t.length,o=!!t.decoder,s=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(s)n=r.shift();else if(!e||e>=i)n=o?r.join(""):1===r.length?r[0]:R.concat(r,i),r.length=0;else if(e<r[0].length){var a=r[0];n=a.slice(0,e),r[0]=a.slice(e)}else if(e===r[0].length)n=r.shift();else{n=o?"":new R(e);for(var c=0,u=0,f=r.length;u<f&&c<e;u++){var a=r[0],l=Math.min(e-c,a.length);o?n+=a.slice(0,l):a.copy(n,c,0,l),l<a.length?r[0]=a.slice(l):r.shift(),c+=l}}return n}function _(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,E(k,t,e))}function k(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function S(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=i;var E=n(81),M=n(84),R=n(9).Buffer;i.ReadableState=r;var j,C=(n(2),function(e,t){return e.listeners(t).length});!function(){try{j=n(5)}catch(e){}finally{j||(j=n(2).EventEmitter)}}();var R=n(9).Buffer,A=n(82);A.inherits=n(12);var B=n(13),L=void 0;L=B&&B.debuglog?B.debuglog("stream"):function(){};var O;A.inherits(i,j);var I,I;i.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=new R(e,t),t="")),o(this,n,e,t,!1)},i.prototype.unshift=function(e){var t=this._readableState;return o(this,t,e,"",!0)},i.prototype.isPaused=function(){return this._readableState.flowing===!1},i.prototype.setEncoding=function(e){return O||(O=n(85).StringDecoder),this._readableState.decoder=new O(e),this._readableState.encoding=e,this};var T=8388608;i.prototype.read=function(e){L("read",e);var t=this._readableState,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return L("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?_(this):l(this),null;if(e=c(e,t),0===e&&t.ended)return 0===t.length&&_(this),null;var r=t.needReadable;L("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,L("length less than watermark",r)),(t.ended||t.reading)&&(r=!1,L("reading or ended",r)),r&&(L("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=c(n,t));var i;return i=e>0?w(e,t):null,null===i&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&_(this),null!==i&&this.emit("data",i),i},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){L("onunpipe"),e===f&&i()}function r(){L("onend"),e.end()}function i(){L("cleanup"),e.removeListener("close",a),e.removeListener("finish",c),e.removeListener("drain",p),e.removeListener("error",s),e.removeListener("unpipe",n),f.removeListener("end",r),f.removeListener("end",i),f.removeListener("data",o),v=!0,!l.awaitDrain||e._writableState&&!e._writableState.needDrain||p()}function o(t){L("ondata");var n=e.write(t);!1===n&&(1!==l.pipesCount||l.pipes[0]!==e||1!==f.listenerCount("data")||v||(L("false write response, pause",f._readableState.awaitDrain),f._readableState.awaitDrain++),f.pause())}function s(t){L("onerror",t),u(),e.removeListener("error",s),0===C(e,"error")&&e.emit("error",t)}function a(){e.removeListener("finish",c),u()}function c(){L("onfinish"),e.removeListener("close",a),u()}function u(){L("unpipe"),f.unpipe(e)}var f=this,l=this._readableState;switch(l.pipesCount){case 0:l.pipes=e;break;case 1:l.pipes=[l.pipes,e];break;default:l.pipes.push(e)}l.pipesCount+=1,L("pipe count=%d opts=%j",l.pipesCount,t);var h=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,d=h?r:i;l.endEmitted?E(d):f.once("end",d),e.on("unpipe",n);var p=g(f);e.on("drain",p);var v=!1;return f.on("data",o),e._events&&e._events.error?M(e._events.error)?e._events.error.unshift(s):e._events.error=[s,e._events.error]:e.on("error",s),e.once("close",a),e.once("finish",c),e.emit("pipe",f),l.flowing||(L("pipe resume"),f.resume()),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=S(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var n=j.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&!this._readableState.endEmitted){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&l(this,r):E(v,this))}return n},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var e=this._readableState;return e.flowing||(L("resume"),e.flowing=!0,m(this,e)),this},i.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(L("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(L("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var o=r.push(i);o||(n=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return x(o,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){L("wrapped _read",t),n&&(n=!1,e.resume())},r},i._fromList=w},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){function r(e){if(e&&!c(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function s(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=n(9).Buffer,c=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=i)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(e,t){C=C||n(80),e=e||{},this.objectMode=!!e.objectMode,t instanceof C&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){p(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new k(this),this.corkedRequestsFree.next=new k(this)}function s(e){return C=C||n(80),this instanceof s||this instanceof C?(this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void R.call(this)):new s(e)}function a(e,t){var n=new Error("write after end");e.emit("error",n),x(t,n)}function c(e,t,n,r){var i=!0;if(!E.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),x(r,o),i=!1}return i}function u(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new E(t,n)),t}function f(e,t,n,r,o){n=u(t,n,r),E.isBuffer(n)&&(r="buffer");var s=t.objectMode?1:n.length;t.length+=s;var a=t.length<t.highWaterMark;if(a||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest=new i(n,r,o),c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else l(e,t,!1,s,n,r,o);return a}function l(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function h(e,t,n,r,i){--t.pendingcb,n?x(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function p(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(d(n),t)h(e,n,r,t,i);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||m(e,n),r?S(g,e,n,o,i):g(e,n,o,i)}}function g(e,t,n,r){n||v(e,t),t.pendingcb--,r(),w(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;l(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,t.corkedRequestsFree=o.next,o.next=null}else{for(;n;){var a=n.chunk,c=n.encoding,u=n.callback,f=t.objectMode?1:a.length;if(l(e,t,!1,f,a,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function w(e,t){var n=y(t);return n&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),n}function _(e,t,n){t.ending=!0,w(e,t),n&&(t.finished?x(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function k(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}e.exports=s;var x=n(81),S=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:x,E=n(9).Buffer;s.WritableState=o;var M=n(82);M.inherits=n(12);var R,j={deprecate:n(87)};!function(){try{R=n(5)}catch(e){}finally{R||(R=n(2).EventEmitter)}}();var E=n(9).Buffer;M.inherits(s,R);var C;o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:j.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var C;s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},s.prototype.write=function(e,t,n){var i=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),E.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=r),i.ended?a(this,n):c(this,i,e,n)&&(i.pendingcb++,o=f(this,i,e,t,n)),o},s.prototype.cork=function(){var e=this._writableState;e.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||m(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},s.prototype._write=function(e,t,n){n(new Error("not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||_(this,r,n)}},function(e,t,n){e.exports=n(13).deprecate},function(e,t,n){var r=n(4),i=n(89),o=n(12),s=n(92),a=new Buffer([0]),c=function(e,t){e._corked?e.once("uncork",t):t()},u=function(e,t){return function(n){n?e.destroy("premature close"===n.message?null:n):t&&!e._ended&&e.end()}},f=function(e,t){return e?e._writableState&&e._writableState.finished?t():e._writableState?e.end(t):(e.end(),void t()):t()},l=function(e){return new r.Readable({objectMode:!0,highWaterMark:16}).wrap(e)},h=function(e,t,n){return this instanceof h?(r.Duplex.call(this,n),this._writable=null,this._readable=null,this._readable2=null,this._forwardDestroy=!n||n.destroy!==!1,this._forwardEnd=!n||n.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),void(t&&this.setReadable(t))):new h(e,t,n)};o(h,r.Duplex),h.obj=function(e,t,n){return n||(n={}),n.objectMode=!0,n.highWaterMark=16,new h(e,t,n)},h.prototype.cork=function(){1===++this._corked&&this.emit("cork")},h.prototype.uncork=function(){this._corked&&0===--this._corked&&this.emit("uncork")},h.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)return void(e&&e.destroy&&e.destroy());if(null===e||e===!1)return void this.end();var t=this,n=i(e,{writable:!0,readable:!1},u(this,this._forwardEnd)),r=function(){var e=t._ondrain;t._ondrain=null,e&&e()},o=function(){t._writable.removeListener("drain",r),n()};this._unwrite&&process.nextTick(r),this._writable=e,this._writable.on("drain",r),this._unwrite=o,this.uncork()},h.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)return void(e&&e.destroy&&e.destroy());if(null===e||e===!1)return this.push(null),void this.resume();var t=this,n=i(e,{writable:!1,readable:!0},u(this)),r=function(){t._forward()},o=function(){t.push(null)},s=function(){t._readable2.removeListener("readable",r),t._readable2.removeListener("end",o),n()};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:l(e),this._readable2.on("readable",r),this._readable2.on("end",o),this._unread=s,this._forward()},h.prototype._read=function(){this._drained=!0,this._forward()},h.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){this._forwarding=!0;for(var e;this._drained&&null!==(e=s(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},h.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;process.nextTick(function(){t._destroy(e)})}},h.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},h.prototype._write=function(e,t,n){return this.destroyed?n():this._corked?c(this,this._write.bind(this,e,t,n)):e===a?this._finish(n):this._writable?void(this._writable.write(e)===!1?this._ondrain=n:n()):n()},h.prototype._finish=function(e){var t=this;this.emit("preend"),c(this,function(){f(t._forwardEnd&&t._writable,function(){t._writableState.prefinished===!1&&(t._writableState.prefinished=!0),t.emit("prefinish"),c(t,e)})})},h.prototype.end=function(e,t,n){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(a),r.Writable.prototype.end.call(this,n))},e.exports=h},function(e,t,n){var r=n(90),i=function(){},o=function(e){return e.setHeader&&"function"==typeof e.abort},s=function(e,t,n){if("function"==typeof t)return s(e,null,t);t||(t={}),n=r(n||i);var a=e._writableState,c=e._readableState,u=t.readable||t.readable!==!1&&e.readable,f=t.writable||t.writable!==!1&&e.writable,l=function(){e.writable||h()},h=function(){f=!1,u||n()},d=function(){u=!1,f||n()},p=function(){return(!u||c&&c.ended)&&(!f||a&&a.ended)?void 0:n(new Error("premature close"))},g=function(){e.req.on("finish",h)};return o(e)?(e.on("complete",h),e.on("abort",p),e.req?g():e.on("request",g)):f&&!a&&(e.on("end",l),e.on("close",l)),e.on("end",d),e.on("finish",h),t.error!==!1&&e.on("error",n),e.on("close",p),function(){e.removeListener("complete",h),e.removeListener("abort",p),e.removeListener("request",g),e.req&&e.req.removeListener("finish",h),e.removeListener("end",l),e.removeListener("close",l),e.removeListener("finish",h),e.removeListener("end",d),e.removeListener("error",n),e.removeListener("close",p)}};e.exports=s},function(e,t,n){function r(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}var i=n(91);e.exports=i(r),r.proto=r(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0})})},function(e,t){function n(e,t){function r(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];var r=e.apply(this,t),i=t[t.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach(function(e){r[e]=i[e]}),r}if(e&&t)return n(e)(t);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(t){r[t]=e[t]}),r}e.exports=n},function(e,t){function n(e){var t=e._readableState;return t?t.objectMode?e.read():e.read(r(t)):null}function r(e){return e.buffer.length?e.buffer.head?e.buffer.head.data.length:e.buffer[0].length:e.length}e.exports=n}])},function(e,t,n){global.vasync=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e){var t;for(t in e)return!1;return!0}function i(e,t){var n,r,i,o;if(p.equal(typeof e,"object",'"args" must be an object'),p.ok(Array.isArray(e.funcs),'"args.funcs" must be specified and must be an array'),p.equal(typeof t,"function","callback argument must be specified and must be a function"),n=e.funcs.slice(0),r={operations:new Array(n.length),successes:[],ndone:0,nerrors:0},0===n.length)return setImmediate(function(){t(null,r)}),r;for(i=function(e){return function(i,o){if(p.equal(e.status,"pending"),e.err=i,e.result=o,e.status=i?"fail":"ok",i?r.nerrors++:r.successes.push(o),!(++r.ndone<n.length)){var s=r.operations.filter(function(e){return"fail"==e.status}).map(function(e){return e.err});s.length>0?t(new m.MultiError(s),r):t(null,r)}}},o=0;o<n.length;o++)r.operations[o]={func:n[o],funcname:n[o].name||"(anon)",status:"pending"},n[o](i(r.operations[o]));return r}function o(e,t){var n,r;return p.equal(typeof e,"object",'"args" must be an object'),p.equal(typeof e.func,"function",'"args.func" must be specified and must be a function'),p.ok(Array.isArray(e.inputs),'"args.inputs" must be specified and must be an array'),n=e.func,r=e.inputs.map(function(e){return function(t){return n(e,t)}}),i({funcs:r},t)}function s(e,t){var n,r,i,o;return p.equal(typeof e,"object",'"args" must be an object'),p.ok(Array.isArray(e.funcs),'"args.funcs" must be specified and must be an array'),n=e.funcs.slice(0),r=e.arg,i={operations:n.map(function(e){return{func:e,funcname:e.name||"(anon)",status:"waiting"}}),successes:[],ndone:0,nerrors:0},0===n.length?(setImmediate(function(){t(null,i)}),i):(o=function(e,s){if(i.nerrors>0||i.ndone>=i.operations.length)throw new m.VError("pipeline callback invoked after the pipeline has already completed (%j)",i);var a=i.operations[i.ndone++];if(p.equal(a.status,"pending"),a.status=e?"fail":"ok",
a.err=e,a.result=s,e?i.nerrors++:i.successes.push(s),e||i.ndone==n.length)t(e,i);else{var c=i.operations[i.ndone];c.status="pending",setImmediate(function(){c.func(r,o)})}},i.operations[0].status="pending",n[0](r,o),i)}function a(e,t){p.equal(typeof e,"object",'"args" must be an object'),p.equal(typeof e.func,"function",'"args.func" must be specified and must be a function'),p.ok(Array.isArray(e.inputs),'"args.inputs" must be specified and must be an array'),p.equal(typeof t,"function","callback argument must be specified and must be a function");var n=e.func,r=e.inputs.map(function(e){return function(t,r){return n(e,r)}});return s({funcs:r},t)}function c(e,t){return new f({worker:e,concurrency:t})}function u(e){return new f(e)}function f(e){p.ok(e.hasOwnProperty("worker")),p.equal(typeof e.worker,"function"),p.ok(e.hasOwnProperty("concurrency")),p.equal(typeof e.concurrency,"number"),p.equal(Math.floor(e.concurrency),e.concurrency),p.ok(e.concurrency>0),g.EventEmitter.call(this),this.nextid=0,this.worker=e.worker,this.worker_name=e.worker.name||"anon",this.npending=0,this.pending={},this.queued=[],this.closed=!1,this.ended=!1,this.concurrency=e.concurrency,this.saturated=void 0,this.empty=void 0,this.drain=void 0}function l(e){return new h(e)}function h(e){p.ok(!e||!e.nrecent||"number"==typeof e.nrecent,'"nrecent" must have type "number"'),g.EventEmitter.call(this);var t=e&&e.nrecent?e.nrecent:10;t>0&&(this.nrecent=t,this.recent=[]),this.pending={},this.scheduled=!1}function d(e,t){var n,r,i;return p.ok(Array.isArray(e)),p.ok(1==arguments.length||"function"==typeof t),e=e.slice(0),n={operations:e.map(function(e){return{func:e,funcname:e.name||"(anon)",status:"waiting"}}),successes:[],ndone:0,nerrors:0},0===e.length?(t&&setImmediate(function(){t(null,n)}),n):(i=function(o,s){var a,c,u;if(void 0===s&&(s=null),o!=r)throw new m.VError('vasync.waterfall: function %d ("%s") invoked its callback twice',o,n.operations[o].funcname);p.equal(o,n.ndone),c=n.operations[n.ndone++],a=Array.prototype.slice.call(arguments,2),p.equal(c.status,"pending"),c.status=s?"fail":"ok",c.err=s,c.results=a,s?n.nerrors++:n.successes.push(a),s||n.ndone==e.length?t&&(a.unshift(s),t.apply(null,a)):(u=n.operations[n.ndone],u.status="pending",r++,a.push(i.bind(null,r)),setImmediate(function(){u.func.apply(null,a)}))},n.operations[0].status="pending",r=0,e[0](i.bind(null,r)),n)}var p=n(1),g=n(2),v=n(3),m=n(4);t.parallel=i,t.forEachParallel=o,t.pipeline=s,t.forEachPipeline=a,t.queue=c,t.queuev=u,t.barrier=l,t.waterfall=d,global.setImmediate||(global.setImmediate=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(0),t.unshift(e),setTimeout.apply(this,t)}),v.inherits(f,g.EventEmitter),f.prototype.push=function(e,t){if(!Array.isArray(e))return this.pushOne(e,t);var n=this;return e.map(function(e){return n.pushOne(e,t)})},f.prototype.updateConcurrency=function(e){if(this.closed)throw new m.VError("update concurrency invoked after queue closed");this.concurrency=e,this.dispatchNext()},f.prototype.close=function(){var e=this;e.closed||(e.closed=!0,0===e.npending&&0===e.queued.length&&setImmediate(function(){e.ended||(e.ended=!0,e.emit("end"))}))},f.prototype.pushOne=function(e,t){if(this.closed)throw new m.VError("push invoked after queue closed");var n=++this.nextid,r={id:n,task:e,callback:t};return this.queued.push(r),this.dispatchNext(),n},f.prototype.dispatchNext=function(){var e=this;if(0===e.npending&&0===e.queued.length)e.drain&&e.drain(),e.emit("drain"),e.closed&&(e.ended=!0,e.emit("end"));else if(e.queued.length>0)for(;e.queued.length>0&&e.npending<e.concurrency;){var t=e.queued.shift();e.dispatch(t),0===e.queued.length&&(e.empty&&e.empty(),e.emit("empty"))}},f.prototype.dispatch=function(e){var t=this;p.ok(!this.pending.hasOwnProperty(e.id)),p.ok(this.npending<this.concurrency),p.ok(!this.ended),this.npending++,this.pending[e.id]=e,this.npending===this.concurrency&&(this.saturated&&this.saturated(),this.emit("saturated")),setImmediate(function(){t.worker(e.task,function(n){--t.npending,delete t.pending[e.id],e.callback&&e.callback.apply(null,arguments),t.dispatchNext()})})},f.prototype.length=function(){return this.queued.length},f.prototype.kill=function(){this.killed=!0,this.queued=[],this.drain=void 0,this.close()},v.inherits(h,g.EventEmitter),h.prototype.start=function(e){p.ok(!this.pending.hasOwnProperty(e),'operation "'+e+'" is already pending'),this.pending[e]=Date.now()},h.prototype.done=function(e){if(p.ok(this.pending.hasOwnProperty(e),'operation "'+e+'" is not pending'),this.recent&&(this.recent.push({name:e,start:this.pending[e],done:Date.now()}),this.recent.length>this.nrecent&&this.recent.shift()),delete this.pending[e],r(this.pending)&&!this.scheduled){this.scheduled=!0;var t=this;setImmediate(function(){t.scheduled=!1,r(t.pending)&&t.emit("drain")})}}},function(e,t){e.exports=n(19)},function(e,t){e.exports=n(5)},function(e,t){e.exports=n(1)},function(e,t,n){function r(e){var t,n,i,o,s;return this instanceof r?(e instanceof Error||"object"==typeof e?t=Array.prototype.slice.call(arguments,1):(t=Array.prototype.slice.call(arguments,0),e=void 0),e&&e.strict||(t=t.map(function(e){return null===e?"null":void 0===e?"undefined":e})),s=t.length>0?u.sprintf.apply(null,t):"",this.jse_shortmsg=s,this.jse_summary=s,e&&(i=e.cause,i&&e.cause instanceof Error||(i=e),i&&i instanceof Error&&(this.jse_cause=i,this.jse_summary+=": "+i.message)),this.message=this.jse_summary,Error.call(this,this.jse_summary),Error.captureStackTrace&&(o=e?e.constructorOpt:void 0,o=o||arguments.callee,Error.captureStackTrace(this,o)),this):(t=Array.prototype.slice.call(arguments,0),n=Object.create(r.prototype),r.apply(n,arguments),n)}function i(){var e,t,n,o;if(t={},t.constructorOpt=i,arguments[0]instanceof Error)t.cause=arguments[0],e=Array.prototype.slice.call(arguments,1);else if("object"==typeof arguments[0]){for(n in arguments[0])t[n]=arguments[0][n];e=Array.prototype.slice.call(arguments,1)}else e=Array.prototype.slice.call(arguments,0);t.strict=!0,o=[t].concat(e),r.apply(this,o)}function o(e){a.ok(e.length>0),this.ase_errors=e,r.call(this,e[0],"first of %d error%s",e.length,1==e.length?"":"s")}function s(e){Error.call(this);var t,n,r;"object"==typeof e?t=Array.prototype.slice.call(arguments,1):(t=Array.prototype.slice.call(arguments,0),e=void 0),t.length>0?this.message=u.sprintf.apply(null,t):this.message="",e&&(e instanceof Error?n=e:(n=e.cause,r=e.constructorOpt)),Error.captureStackTrace(this,r||this.constructor),n&&this.cause(n)}var a=n(1),c=n(3),u=n(5);e.exports=r,r.VError=r,r.SError=i,r.WError=s,r.MultiError=o,c.inherits(r,Error),r.prototype.name="VError",r.prototype.toString=function(){var e=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e+=": "+this.message),e},r.prototype.cause=function(){return this.jse_cause},c.inherits(i,r),c.inherits(o,r),c.inherits(s,Error),s.prototype.name="WError",s.prototype.toString=function(){var e=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e+=": "+this.message),this.we_cause&&this.we_cause.message&&(e+="; caused by "+this.we_cause.toString()),e},s.prototype.cause=function(e){return e instanceof Error&&(this.we_cause=e),this.we_cause}},function(e,t,n){function r(e){var t,n,r,i,u,f,l,h,d,p=["([^%]*)","%","(['\\-+ #0]*?)","([1-9]\\d*)?","(\\.([1-9]\\d*))?","[lhjztL]*?","([diouxXfFeEgGaAcCsSp%jr])"].join(""),g=new RegExp(p),v=Array.prototype.slice.call(arguments,1),m="",y=1;for(a.equal("string",typeof e);null!==(d=g.exec(e));)if(m+=d[1],e=e.substring(d[0].length),t=d[2]||"",n=d[3]||0,r=d[4]||"",i=d[6],u=!1,l=!1,f=" ","%"!=i){if(0===v.length)throw new Error("too few args to sprintf");if(h=v.shift(),y++,t.match(/[\' #]/))throw new Error("unsupported flags: "+t);if(r.length>0)throw new Error("non-zero precision not supported");switch(t.match(/-/)&&(u=!0),t.match(/0/)&&(f="0"),t.match(/\+/)&&(l=!0),i){case"s":if(void 0===h||null===h)throw new Error("argument "+y+": attempted to print undefined or null as a string");m+=o(f,n,u,h.toString());break;case"d":h=Math.floor(h);case"f":l=l&&h>0?"+":"",m+=l+o(f,n,u,h.toString());break;case"x":m+=o(f,n,u,h.toString(16));break;case"j":0===n&&(n=10),m+=c.inspect(h,!1,n);break;case"r":m+=s(h);break;default:throw new Error("unsupported conversion: "+i)}}else m+="%";return m+=e}function i(){process.stdout.write(r.apply(this,arguments))}function o(e,t,n,r){for(var i=r;i.length<t;)n?i+=e:i=e+i;return i}function s(e){var t;if(!(e instanceof Error))throw new Error(r("invalid type for %%r: %j",e));if(t="EXCEPTION: "+e.constructor.name+": "+e.stack,e.cause&&"function"==typeof e.cause){var n=e.cause();n&&(t+="\nCaused by: "+s(n))}return t}var a=n(1),c=n(3);t.sprintf=r,t.printf=i}])},function(e,t,n){var r=n(1),i={promiseCb:function(e,t){return function(n,i,o,s){n?e.reject(n):1==t?r.isArray(s)&&0!=s.length?e.resolve(s[0]):e.resolve(null):e.resolve(s)}},promiseCb2:function(e,t){return function(n,r){n?e.reject(n):r?e.resolve(r):e.resolve(t)}},promiseCb3:function(e){return function(t,n,r){if(t)e.reject(t);else{var i="";n&&(i+="stdout:"+n+"\r\n"),r&&(i+="stderr:"+r),e.resolve(i)}}},emptyPromise:function(e){var t=q.defer();return t.resolve(e),t.promise},promiseChainSimple:function(e,t){var n=[];return e.forEach(function(e){n.push(t(e))}),q.all(n)},errCb:function(e){return function(t){e.reject(t)}}};e.exports=i},function(e,t,n){var r=(process.argv.length>3?process.argv[2]:"0",process.argv.length>3?process.argv[3]:"fakeip"),i=process.argv.length>3?process.argv[4]:"fakeip",o=process.argv.length>3?process.argv[5]:"fakeip",s=process.argv.length>3?process.argv[6]:"fakeip";e.exports=function(){if("fakeip"!=r){var e=n(3),t=n(6);console.info("launch web server");var a=t.createServer(function(t,n){var a={IP:r,User:i,Password:o},c={hostname:a.IP,port:443,path:t.url,method:t.method,rejectUnauthorized:!1};if("/update"==t.url)console.log("__update__");else if("/version"==t.url)n.writeHead(200,{"Content-Type":"text/plain"}),n.end(s+"\n");else{"/login"==t.url&&(c.path="/cgi-bin/CGILink?cmd=validate&user="+a.User+"&passwd="+a.Password);var u=e.request(c,function(e){console.log("path: ",c.path),console.log("statusCode: ",e.statusCode),console.log("headers: ",e.headers),n.writeHead(e.statusCode,e.headers),e.on("data",function(e){n.write(e,"binary")}),e.on("end",function(){n.end()})});u.on("error",function(e){console.log("error: ",e)}),t.on("data",function(e){u.write(e,"binary")}),t.on("end",function(){u.end()})}});a.listen(3e3)}else console.log("no sapphire proxy")}},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("buffer")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("zlib")}]);